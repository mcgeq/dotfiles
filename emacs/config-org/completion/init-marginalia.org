* init-marginalia.el
:PROPERTIES:
:HEADER-ARGS: :tangle (concat temporary-file-directory "init-marginalia.el") :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
  ;;; init-marginalia.el -- Config for Marginalia -*- lexical-binding: t; -*-

  ;; Filename: init-marginalia.el
  ;; Description: Config for Marginalia
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024, mcge, all rights reserved.
  ;; Create   Date: 2025-01-04 15:00:00
  ;; Version: 0.1
  ;; Modified   By:  mcge <mcgeq@outlook.com>
  ;; Last Modified:  <2025-01-10 Fri 10:37>
  ;; Keywords:
  ;; Compatibility: GNU Emacs 31.0.50

  ;;; Commentary:
  ;;
  ;; Config for Marginalia
  ;;

  ;;; Installation:
  ;;
  ;; Put init-marginalia.el to your load-path.
  ;; The load-path is usually ~/elisp/.
  ;; It's set in your ~/.emacs like this:
  ;; (add-to-list 'load-path (expand-file-name "~/elisp"))
  ;;
  ;; And the following to your ~/.emacs startup file.
  ;;
  ;; (require 'init-marginalia)
  ;;
  ;; No need more.

  ;;; Customize:
  ;;
  ;;
  ;;
  ;; All of the above can customize by:
  ;;      M-x customize-group RET init-aider RET
  ;;

  ;;; Change log:
  ;;

#+END_SRC


** Require
#+BEGIN_SRC emacs-lisp
;;; Require:
(require 'marginalia)

;;; Code:

#+END_SRC

** Basic Configuration
#+BEGIN_SRC emacs-lisp
  ;;; === 基本配置 ===
  
  ;; Enable marginalia mode globally
  (add-hook 'after-init-hook #'marginalia-mode)
  
  ;; Display style (can be customized per category)
  (setq marginalia-align 'right)           ; Align annotations to right
  (setq marginalia-align-offset 0)         ; Offset from window edge
  
  ;; Maximum truncation lengths
  (setq marginalia-max-relative-age 3600)  ; Show relative time for files < 1h old
#+END_SRC

** Annotators Configuration
#+BEGIN_SRC emacs-lisp
  ;;; === 注释器配置 ===
  ;; Marginalia provides rich annotations for different types of candidates
  
  ;; Available annotators (from minimal to full):
  ;; - marginalia-annotators-light  (minimal annotations)
  ;; - marginalia-annotators-heavy  (full annotations)
  
  ;; Default: Use full annotators
  ;; Uncomment to use light annotators for better performance:
  ;; (setq marginalia-annotators marginalia-annotators-light)
#+END_SRC

** Custom Annotators
#+BEGIN_SRC emacs-lisp
  ;;; === 自定义注释器 ===
  
  ;; Example: Add custom annotator for buffers
  (defun mcg/marginalia-annotate-buffer (cand)
    "Custom buffer annotation for CAND."
    (when-let ((buffer (get-buffer cand)))
      (with-current-buffer buffer
        (concat
         (marginalia--fields
          ((marginalia--buffer-status) :face 'marginalia-modified)
          ((marginalia--buffer-size) :width 7 :face 'marginalia-size)
          ((marginalia--buffer-major-mode) :width 20 :face 'marginalia-mode)
          ((if buffer-file-name
               (abbreviate-file-name (file-name-directory buffer-file-name))
             "") :face 'marginalia-file-name))))))
  
  ;; Register custom annotator (uncomment to use)
  ;; (add-to-list 'marginalia-annotator-registry
  ;;              '(buffer mcg/marginalia-annotate-buffer builtin none))
#+END_SRC

** Category Customization
#+BEGIN_SRC emacs-lisp
  ;;; === 分类自定义 ===
  
  ;; Customize which information to show for each category
  ;; Available categories: buffer, file, command, variable, face, etc.
  
  ;; Example: Customize file annotations
  ;; (setq marginalia-command-categories
  ;;       '((find-file . file)
  ;;         (project-find-file . project-file)))
#+END_SRC

** Keybindings
#+BEGIN_SRC emacs-lisp
  ;;; === 键绑定 ===
  
  ;; Cycle between annotator levels (minimal -> light -> heavy)
  (define-key minibuffer-local-map (kbd "M-A") #'marginalia-cycle)
  
  ;; Helper function to toggle marginalia
  (defun mcg/toggle-marginalia ()
    "Toggle marginalia mode on/off."
    (interactive)
    (if marginalia-mode
        (progn
          (marginalia-mode -1)
          (message "Marginalia disabled"))
      (marginalia-mode 1)
      (message "Marginalia enabled")))
  
  (global-set-key (kbd "C-c t m") #'mcg/toggle-marginalia)
#+END_SRC

** Integration with Other Packages
#+BEGIN_SRC emacs-lisp
  ;;; === 集成配置 ===
  
  ;; Marginalia works well with:
  ;; - Vertico: Vertical completion UI
  ;; - Consult: Consulting commands
  ;; - Embark: Contextual actions
  ;; - Orderless: Flexible matching
  
  ;; All integrations are automatic when packages are loaded
#+END_SRC

** Ends
#+BEGIN_SRC emacs-lisp
(provide 'init-marginalia)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-marginalia.el ends here
#+END_SRC
