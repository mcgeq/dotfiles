* init-color-rg.el
:PROPERTIES:
:HEADER-ARGS: :tangle (concat temporary-file-directory "init-color-rg.el") :lexical t
:END:

** Headers

#+BEGIN_SRC emacs-lisp
  ;;; init-color-rg.el -- Config for color-rg -*- lexical-binding: t; -*-

  ;; Filename: init-color-rg.el
  ;; Description: Config for color-rg
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024, mcge, all rights reserved.
  ;; Create   Date: 2025-01-04 15:00:00
  ;; Version: 0.1
  ;; Modified   By:  mcge <mcgeq@outlook.com>
  ;; Last Modified:  <2025-01-10 Fri 10:05>
  ;; Keywords:
  ;; Compatibility: GNU Emacs 31.0.50

  ;;; Commentary:
  ;;
  ;; Config for color-rg
  ;;

  ;;; Installation:
  ;;
  ;; Put init-color-rg.el to your load-path.
  ;; The load-path is usually ~/elisp/.
  ;; It's set in your ~/.emacs like this:
  ;; (add-to-list 'load-path (expand-file-name "~/elisp"))
  ;;
  ;; And the following to your ~/.emacs startup file.
  ;;
  ;; (require 'init-color-rg)
  ;;
  ;; No need more.

  ;;; Customize:
  ;;
  ;;
  ;;
  ;; All of the above can customize by:
  ;;      M-x customize-group RET color-rg RET
  ;;

  ;;; Change log:
  ;;  2025-02-16: 添加基础配置和辅助函数
  ;;

#+END_SRC

** Require

#+BEGIN_SRC emacs-lisp
  ;;; Require:
  (require 'color-rg)

#+END_SRC

** Basic Configuration
#+BEGIN_SRC emacs-lisp
  ;;; === 基础配置 ===
  
  ;; Enable search file regexp
  (setq color-rg-search-file-regexp nil)  ; 不限制文件类型，搜索所有文件
  
  ;; Search ignore directories
  (setq color-rg-search-ignore-dirs
        '(".git" ".svn" ".hg" "node_modules" "dist" "build" ".cache"
          "target" ".idea" ".vscode" "__pycache__" ".pytest_cache"))
  
  ;; Search ignore files
  (setq color-rg-search-ignore-files
        '("*.pyc" "*.o" "*.elc" "*.class" "*.jar" "*.war" "*.ear"
          "*.min.js" "*.min.css" "*.log" "*.lock" "package-lock.json"))
  
  ;; Kill process on quit (faster cleanup)
  (setq color-rg-kill-temp-buffer-p t)
  
  ;; Mac specific: use GNU grep if available
  (when (eq system-type 'darwin)
    (when (executable-find "ggrep")
      (setq color-rg-mac-grep "ggrep")))
#+END_SRC

** Display Settings
#+BEGIN_SRC emacs-lisp
  ;;; === 显示设置 ===
  
  ;; Window height (rows)
  (setq color-rg-window-height 15)
  
  ;; Show line numbers in results
  (add-hook 'color-rg-mode-hook
            (lambda ()
              (when (fboundp 'display-line-numbers-mode)
                (display-line-numbers-mode 1))))
#+END_SRC

** Performance Optimization
#+BEGIN_SRC emacs-lisp
  ;;; === 性能优化 ===
  
  ;; Limit results for better performance
  (setq color-rg-regexp-match-limit 10000)  ; 限制匹配数量
  
  ;; Use faster search tool if available
  (when (executable-find "rg")
    ;; ripgrep is faster than grep
    (setq color-rg-search-command "rg"))
#+END_SRC

** Code
#+BEGIN_SRC emacs-lisp
  ;;; === 辅助函数 ===
  
  (defun mcg/color-rg-search-project-with-type ()
    "Search in project with file type filter."
    (interactive)
    (let ((file-type (completing-read "File type: "
                                      '("*.el" "*.org" "*.js" "*.py" "*.go" 
                                        "*.rs" "*.java" "*.c" "*.cpp" "*.h"
                                        "*.md" "*.txt" "*.json" "*.yaml"))))
      (let ((color-rg-search-file-regexp file-type))
        (call-interactively 'color-rg-search-input-in-project))))
  
  (defun mcg/color-rg-search-in-org-directory ()
    "Search in org directory."
    (interactive)
    (let ((org-dir (if (boundp 'mcg-org-directory)
                       mcg-org-directory
                     (expand-file-name "~/org"))))
      (when (file-directory-p org-dir)
        (let ((default-directory org-dir))
          (call-interactively 'color-rg-search-input)))))

#+END_SRC


** Ends
#+BEGIN_SRC emacs-lisp
(provide 'init-color-rg)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-color-rg.el ends here
#+END_SRC
