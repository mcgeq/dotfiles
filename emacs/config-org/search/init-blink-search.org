* init-blink-search.el
:PROPERTIES:
:HEADER-ARGS: :tangle (concat temporary-file-directory "init-blink-search.el") :lexical t
:END:

** Headers

#+BEGIN_SRC emacs-lisp
  ;;; init-blink-search.el -- Config for blink search -*- lexical-binding: t; -*-

  ;; Filename: init-blink-search.el
  ;; Description: Config for blink search
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024, mcge, all rights reserved.
  ;; Create   Date: 2025-01-04 15:00:00
  ;; Version: 0.1
  ;; Modified   By:  mcge <mcgeq@outlook.com>
  ;; Last Modified:  <2025-01-10 Fri 10:11>
  ;; Keywords:
  ;; Compatibility: GNU Emacs 31.0.50

  ;;; Commentary:
  ;;
  ;; Config for blink search
  ;;

  ;;; Installation:
  ;;
  ;; Put init-blink-search.el to your load-path.
  ;; The load-path is usually ~/elisp/.
  ;; It's set in your ~/.emacs like this:
  ;; (add-to-list 'load-path (expand-file-name "~/elisp"))
  ;;
  ;; And the following to your ~/.emacs startup file.
  ;;
  ;; (require 'init-blink-search)
  ;;
  ;; No need more.

  ;;; Customize:
  ;;
  ;;
  ;;
  ;; All of the above can customize by:
  ;;      M-x customize-group RET init-aider RET
  ;;

  ;;; Change log:
  ;;

#+END_SRC

** Require

*** Custom const variable and function

#+BEGIN_SRC emacs-lisp
  ;;; Require:
  (require 'blink-search)

#+END_SRC

** Basic Configuration
#+BEGIN_SRC emacs-lisp
  ;;; === 基本配置 ===
  
  ;; Common directories for quick access
  (setq blink-search-common-directory 
        `(("HOME" "~/")
          ("REPO" ,(concat mcgemacs-root-dir "/site-lisp/extensions"))
          ("CONFIG" ,mcgemacs-config-dir)
          ("BLOG" ,mcgemacs-blog-org-dir)
          ("DOWNLOADS" "~/Downloads/")
          ("DOCUMENTS" "~/Documents/")
          ("DESKTOP" "~/Desktop/")))
  
  ;; Python command (ensure correct Python interpreter)
  (setq blink-search-python-command 
        (if (memq system-type '(cygwin windows-nt ms-dos)) 
            "python.exe" 
          "python3"))
#+END_SRC

** Display Settings
#+BEGIN_SRC emacs-lisp
  ;;; === 显示设置 ===
  
  ;; Enable icons in menu
  (setq blink-search-enable-icon t)
  
  ;; Posframe settings (floating window)
  (setq blink-search-enable-posframe t)           ; 启用浮动窗口
  (setq blink-search-posframe-width-ratio 0.8)    ; 宽度比例 (80% 屏幕宽度)
  (setq blink-search-posframe-height-ratio 0.6)   ; 高度比例 (60% 屏幕高度)
  (setq blink-search-posframe-standalone nil)     ; 非独立窗口
  
  ;; Flash line after navigation
  (setq blink-search-flash-line-delay 0.3)        ; 导般后闪烁 0.3 秒
#+END_SRC

** Search Backends
#+BEGIN_SRC emacs-lisp
  ;;; === 搜索后端 ===
  
  ;; Available backends (nil means use all backends)
  ;; Uncomment and customize if you want to limit backends
  ;; (setq blink-search-search-backends 
  ;;       '("Buffer List"           ; 缓冲区列表
  ;;         "Recent File"           ; 最近文件
  ;;         "Current Buffer"        ; 当前缓冲区
  ;;         "Grep File"             ; 文件搜索
  ;;         "IMenu"                 ; IMenu 导般
  ;;         "ELisp Symbol"          ; ELisp 符号
  ;;         "Find File"             ; 查找文件
  ;;         "Common Directory"))
#+END_SRC

** File Manager Integration
#+BEGIN_SRC emacs-lisp
  ;;; === 文件管理器集成 ===
  
  ;; File manager to use (dired or eaf-file-manager)
  (setq blink-search-file-manager 'dired)
  
  ;; Browser function for web search
  ;; (setq blink-search-browser-function #'browse-url-default-browser)
#+END_SRC

** Storage and History
#+BEGIN_SRC emacs-lisp
  ;;; === 存储和历史 ===
  
  ;; History file path
  (setq blink-search-history-path 
        (expand-file-name (concat user-emacs-directory 
                                 (file-name-as-directory "blink-search") 
                                 "history.txt")))
  
  ;; Database path for key-value store
  (setq blink-search-db-path 
        (expand-file-name "blink-search.db" user-emacs-directory))
  
  ;; Database table name
  (setq blink-search-db-table "kvstore")
#+END_SRC

** Debug Settings
#+BEGIN_SRC emacs-lisp
  ;;; === 调试设置 ===
  
  ;; Debug mode (enable if you encounter issues)
  (setq blink-search-enable-debug nil)
  
  ;; Enable detailed logging
  (setq blink-search-enable-log nil)
#+END_SRC

** Helper Functions
#+BEGIN_SRC emacs-lisp
  ;;; === 辅助函数 ===
  
  (defun mcg/blink-search-grep-current-dir ()
    "Search files in current directory using blink-search."
    (interactive)
    (let ((default-directory (or (when buffer-file-name
                                   (file-name-directory buffer-file-name))
                                 default-directory)))
      (blink-search)))
  
  (defun mcg/blink-search-project-root ()
    "Search files in project root using blink-search."
    (interactive)
    (let ((project-root (or (and (fboundp 'projectile-project-root)
                                 (projectile-project-root))
                            (and (fboundp 'project-root)
                                 (when-let ((project (project-current)))
                                   (project-root project)))
                            default-directory)))
      (let ((default-directory project-root))
        (blink-search))))
  
  ;; Global keybindings for helper functions
  ;; Main entry: C-c s B (defined in init-keymaps.org)
  (global-set-key (kbd "C-c s D") 'mcg/blink-search-grep-current-dir)
  (global-set-key (kbd "C-c s P") 'mcg/blink-search-project-root)
#+END_SRC


** Ends
#+BEGIN_SRC emacs-lisp
(provide 'init-blink-search)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-blink-search.el ends here
#+END_SRC
