* init-sort-tab.el
:PROPERTIES:
:HEADER-ARGS: :tangle (concat temporary-file-directory "init-sort-tab.el") :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
  ;;; init-sort-tab.el -- Config for Tab -*- lexical-binding: t; -*-

  ;; Filename: init.el
  ;; Description: Config for Tab
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024, mcge, all rights reserved.
  ;; Create   Date: 2025-01-04 15:00:00
  ;; Version: 0.1
  ;; Modified   By:  mcge <mcgeq@outlook.com>
  ;; Last Modified:  <2025-01-10 Fri 10:25>
  ;; Keywords:
  ;; Compatibility: GNU Emacs 31.0.50

  ;;; Commentary:
  ;;
  ;; Config for Tab
  ;;

  ;;; Installation:
  ;;
  ;; Put init-sort-tab.el to your load-path.
  ;; The load-path is usually ~/elisp/.
  ;; It's set in your ~/.emacs like this:
  ;; (add-to-list 'load-path (expand-file-name "~/elisp"))
  ;;
  ;; And the following to your ~/.emacs startup file.
  ;;
  ;; (require 'init-sort-tab)
  ;;
  ;; No need more.

  ;;; Customize:
  ;;
  ;;
  ;;
  ;; All of the above can customize by:
  ;;      M-x customize-group RET init-aider RET
  ;;

  ;;; Change log:
  ;;

#+END_SRC


** Require
#+BEGIN_SRC emacs-lisp
;;; Require:
(require 'sort-tab)

#+END_SRC

** Code
#+BEGIN_SRC emacs-lisp
  ;;; Code:

  ;; Enable sort-tab mode globally
  (sort-tab-mode 1)

#+END_SRC

** Display Settings
#+BEGIN_SRC emacs-lisp
  ;;; === 显示设置 ===
  
  ;; Tab display configuration
  (setq sort-tab-max-length 20)                    ; 标签最大长度
  (setq sort-tab-show-index t)                     ; 显示标签索引号
  (setq sort-tab-position 'bottom)                 ; 标签栏位置 (top/bottom)
  (setq sort-tab-close-button-show t)              ; 显示关闭按钮
  
  ;; Tab appearance
  (setq sort-tab-icon-show t)                      ; 显示图标（如果可用）
  (setq sort-tab-scale-factor 1.0)                 ; 标签缩放因子
  
  ;; Tab sorting
  (setq sort-tab-auto-update t)                    ; 自动更新标签顺序
#+END_SRC

** Hide Rules
#+BEGIN_SRC emacs-lisp
  ;;; === 隐藏规则 ===
  
  ;; Advanced buffer hiding function
  (setq sort-tab-hide-function
        (lambda (buf)
          (let ((name (buffer-name buf)))
            (with-current-buffer buf
              (or
               ;; Hide buffers with leading space
               (string-prefix-p " " name)
               
               ;; Hide system buffers (starting with *)
               (and (string-prefix-p "*" name)
                    (not (or
                          ;; But keep these important buffers visible
                          (string= name "*scratch*")
                          (string= name "*Messages*")
                          (string-prefix-p "*terminal" name))))
               
               ;; Hide specific modes
               (derived-mode-p 'dired-mode)         ; Dired buffers
               (derived-mode-p 'eshell-mode)        ; Eshell buffers
               (derived-mode-p 'shell-mode)         ; Shell buffers
               (derived-mode-p 'vterm-mode)         ; Vterm buffers
               (derived-mode-p 'dirvish-mode)       ; Dirvish buffers
               (derived-mode-p 'magit-status-mode)  ; Magit status
               (derived-mode-p 'magit-diff-mode)    ; Magit diff
               (derived-mode-p 'help-mode)          ; Help buffers
               (derived-mode-p 'helpful-mode)       ; Helpful buffers
               (derived-mode-p 'compilation-mode)   ; Compilation buffers
               
               ;; Hide temporary/preview buffers
               (string-match-p "^\\*.*-preview\\*$" name)
               (string-match-p "^\\*Completions\\*$" name)
               (string-match-p "^\\*Backtrace\\*$" name)
               
               ;; Hide process buffers
               (eq (get-buffer-process buf) t))))))
#+END_SRC

** Helper Functions
#+BEGIN_SRC emacs-lisp
  ;;; === 辅助函数 ===
  
  (defun mcg/sort-tab-select-by-name ()
    "Interactively select a tab by buffer name."
    (interactive)
    (let* ((tabs (sort-tab-get-tabs))
           (tab-names (mapcar #'buffer-name tabs))
           (selected (completing-read "Select tab: " tab-names nil t)))
      (when selected
        (switch-to-buffer selected))))
  
  (defun mcg/sort-tab-move-current-tab-left ()
    "Move current tab to the left."
    (interactive)
    (when (> (length (sort-tab-get-tabs)) 1)
      (sort-tab-move-current-tab -1)))
  
  (defun mcg/sort-tab-move-current-tab-right ()
    "Move current tab to the right."
    (interactive)
    (when (> (length (sort-tab-get-tabs)) 1)
      (sort-tab-move-current-tab 1)))
  
  (defun mcg/sort-tab-info ()
    "Show information about current tabs."
    (interactive)
    (let ((tabs (sort-tab-get-tabs))
          (current (current-buffer)))
      (message "Tabs: %d | Current: %s | Position: %d/%d"
               (length tabs)
               (buffer-name current)
               (1+ (cl-position current tabs))
               (length tabs))))
  
  ;; Global keybindings for helper functions
  (global-set-key (kbd "C-c t s") 'mcg/sort-tab-select-by-name)
  (global-set-key (kbd "C-c t <") 'mcg/sort-tab-move-current-tab-left)
  (global-set-key (kbd "C-c t >") 'mcg/sort-tab-move-current-tab-right)
  (global-set-key (kbd "C-c t i") 'mcg/sort-tab-info)
#+END_SRC

** Performance
#+BEGIN_SRC emacs-lisp
  ;;; === 性能优化 ===
  
  ;; Update interval (in seconds)
  (setq sort-tab-update-interval 0.5)
  
  ;; Maximum number of visible tabs (nil for unlimited)
  (setq sort-tab-max-visible-tabs nil)
#+END_SRC

** Ends
#+BEGIN_SRC emacs-lisp
(provide 'init-sort-tab)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-sort-tab.el ends here
#+END_SRC
