#+TITLE: MCG Emacs Configuration
#+AUTHOR: mcge
#+PROPERTY: header-args:emacs-lisp :tangle init.el :lexical t

* init.el
:PROPERTIES:
:HEADER-ARGS: :tangle init.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
  ;;; init.el --- MCG Emacs Configuration Entry -*- lexical-binding: t; -*-

  ;; Filename: init.el
  ;; Description: 配置架构入口文件
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024-2026, mcge, all rights reserved.
  ;; Create   Date: 2026-01-07
  ;; Version: 3.0
  ;; Keywords: configuration, init
  ;; Compatibility: GNU Emacs 29.0+

  ;;; Commentary:
  ;;
  ;; MCG Emacs 配置架构入口文件。
  ;;
  ;; 此文件负责：
  ;; - 加载核心模块 (core-bootstrap, core-lib, core-modules)
  ;; - 使用 mcg! 宏声明启用的模块
  ;; - 设置延迟加载
  ;; - 加载私有配置
  ;;
  ;; 使用方法：
  ;; 1. 设置环境变量 MCG_EMACS_CONFIG_DIR 指向配置根目录
  ;;    或使用默认路径 (Windows: D:/config, Linux/Mac: ~)
  ;; 2. 在 ~/.emacs.d/init.el 中加载此文件：
  ;;    (load (expand-file-name "site-lisp/config/init.el" mcg-emacs-dir))
  ;;

#+END_SRC

** Load Core Modules
#+BEGIN_SRC emacs-lisp
;;; 加载核心模块

;; 核心引导模块 - 定义路径和性能优化
(require 'core-bootstrap)

;; 核心库模块 - 扩展管理和工具函数
(require 'core-lib)

;; 模块系统 - mcg! 宏和模块加载
(require 'core-modules)

#+END_SRC

** Module Declaration
#+BEGIN_SRC emacs-lisp
;;; 模块声明
;;
;; 使用 mcg! 宏声明启用的模块
;; 语法:
;;   :category module  - 启用模块
;;   :category -module - 禁用模块
;;

(mcg! :ui
      theme           ; 主题配置 (ef-themes)
      modeline        ; 状态栏 (awesome-tray)
      font            ; 字体配置

      :editor
      defaults        ; 编辑器默认配置
      treesit         ; Tree-sitter 支持
      navigation      ; 导航 (avy, ace-window)
      keybindings     ; 快捷键 (markmacro, vundo)

      :completion
      vertico         ; 垂直补全框架
      yasnippet       ; 代码片段

      :tools
      magit           ; Git 客户端
      search          ; 搜索工具 (blink-search, color-rg)
      rime            ; 中文输入法
      utils           ; 工具集 (auto-save, which-key, recentf, helpful)
      sort-tab        ; 标签栏

      :input
      fingertip       ; 结构化编程
      wraplish        ; 中英文混排

      :org
      org             ; Org-mode 基础配置
      org-agenda      ; Agenda 日程管理
      org-babel       ; Babel 代码执行
      org-capture     ; Capture 模板和 Hugo 集成
      org-extras      ; Org 扩展 (download, numbering, consult-todo)

      :docs
      markdown        ; Markdown 支持

      :lang
      lsp             ; LSP 统一配置 (lsp-bridge)
      lsp-common      ; LSP 通用工具
      rust            ; Rust 开发
      python          ; Python 开发
      typescript      ; TypeScript 开发
      web             ; Web 开发 (Vue, HTML, CSS)
      cpp             ; C/C++ 开发
      lua             ; Lua 开发
      zig             ; Zig 开发
      )

#+END_SRC

** Load Modules
#+BEGIN_SRC emacs-lisp
;;; 加载模块

;; 立即加载 UI 模块（启动时需要）
(mcg-load-modules-by-category :ui)

;; 立即加载编辑器模块
(mcg-load-modules-by-category :editor)

;; 立即加载补全模块
(mcg-load-modules-by-category :completion)

;; 立即加载工具模块
(mcg-load-modules-by-category :tools)

;; 立即加载输入模块
(mcg-load-modules-by-category :input)

;; 立即加载 Org 模块
(mcg-load-modules-by-category :org)

;; 立即加载文档模块
(mcg-load-modules-by-category :docs)

;; 设置语言模块延迟加载
;; LSP 模块立即加载（其他语言模块依赖它）
(mcg-load-module :lang 'lsp)
(mcg-load-module :lang 'lsp-common)

;; 设置语言模块的延迟加载
(mcg-setup-deferred-loading)

#+END_SRC

** Load Private Configuration
#+BEGIN_SRC emacs-lisp
;;; 加载私有配置

(let ((private-config (expand-file-name "config.el" mcg-private-dir)))
  (when (file-exists-p private-config)
    (mcg-log "Loading private configuration...")
    (load private-config nil t)))

#+END_SRC

** Startup Complete
#+BEGIN_SRC emacs-lisp
;;; 启动完成

;; 显示模块加载统计
(add-hook 'emacs-startup-hook
          (lambda ()
            (let ((loaded (length mcg-loaded-modules))
                  (deferred (length mcg-deferred-modules))
                  (errors (length mcg-module-load-errors)))
              (mcg-log "Modules: %d loaded, %d deferred, %d errors"
                       loaded deferred errors)
              ;; 如果有错误，显示警告
              (when (> errors 0)
                (message "⚠️ %d module(s) failed to load. Run M-x mcg-list-modules for details."
                         errors)))))

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
(provide 'init)
;;; init.el ends here
#+END_SRC
