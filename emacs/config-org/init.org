#+TITLE: MCG Emacs Configuration
#+AUTHOR: mcge
#+PROPERTY: header-args:emacs-lisp :tangle init.el :lexical t

* init.el
:PROPERTIES:
:HEADER-ARGS: :tangle init.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
  ;;; init.el --- MCG Emacs Configuration Entry -*- lexical-binding: t; -*-

  ;; Filename: init.el
  ;; Description: Configuration architecture entry file
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024-2026, mcge, all rights reserved.
  ;; Create   Date: 2026-01-07
  ;; Version: 3.0
  ;; Keywords: configuration, init
  ;; Compatibility: GNU Emacs 29.0+

  ;;; Commentary:
  ;;
  ;; MCG Emacs configuration architecture entry file.
  ;;
  ;; This file is responsible for:
  ;; - Loading core modules (core-bootstrap, core-lib, core-modules)
  ;; - Using mcg! macro to declare enabled modules
  ;; - Setting up lazy loading
  ;; - Loading private configuration
  ;;
  ;; Usage:
  ;; 1. Set environment variable MCG_EMACS_CONFIG_DIR to config root directory
  ;;    or use default path (Windows: D:/config, Linux/Mac: ~)
  ;; 2. Load this file in ~/.emacs.d/init.el:
  ;;    (load (expand-file-name "site-lisp/config/init.el" mcg-emacs-dir))
  ;;

#+END_SRC

** Load Core Modules
#+BEGIN_SRC emacs-lisp
;;; Load Core Modules

;; Core bootstrap module - define paths and performance optimization
(require 'core-bootstrap)

;; Core library module - extension management and utility functions
(require 'core-lib)

;; Module system - mcg! macro and module loading
(require 'core-modules)

;; Automation module - auto tangle and autoload
(require 'core-autoload)

;; Setup auto tangle on save (only in interactive mode)
(when (not noninteractive)
  (mcg-setup-auto-tangle))

#+END_SRC

** Module Declaration
#+BEGIN_SRC emacs-lisp
;;; Module Declaration
;;
;; Use mcg! macro to declare enabled modules
;; Syntax:
;;   :category module  - Enable module
;;   :category -module - Disable module
;;

(mcg! :ui
      theme           ; Theme configuration (ef-themes)
      modeline        ; Status bar (awesome-tray)
      font            ; Font configuration

      :editor
      defaults        ; Editor default configuration
      treesit         ; Tree-sitter support
      navigation      ; Navigation (avy, ace-window)
      keybindings     ; Keybindings (markmacro, vundo)

      :completion
      vertico         ; Vertical completion framework
      yasnippet       ; Code snippets

      :tools
      magit           ; Git client
      search          ; Search tools (blink-search, color-rg)
      rime            ; Chinese input method
      utils           ; Utilities (auto-save, which-key, recentf, helpful)
      sort-tab        ; Tab bar

      :input
      fingertip       ; Structural editing
      wraplish        ; CJK-English mixed spacing

      :org
      org             ; Org-mode basic configuration
      org-agenda      ; Agenda schedule management
      org-babel       ; Babel code execution
      org-capture     ; Capture templates and Hugo integration
      org-extras      ; Org extensions (download, numbering, consult-todo)

      :docs
      markdown        ; Markdown support

      :lang
      lsp             ; LSP unified configuration (lsp-bridge)
      lsp-common      ; LSP common tools
      rust            ; Rust development
      python          ; Python development
      typescript      ; TypeScript development
      web             ; Web development (Vue, HTML, CSS)
      cpp             ; C/C++ development
      lua             ; Lua development
      zig             ; Zig development
      )

#+END_SRC

** Load Modules
#+BEGIN_SRC emacs-lisp
;;; Load Modules

;; Load UI modules immediately (needed at startup)
(mcg-load-modules-by-category :ui)

;; Load editor modules immediately
(mcg-load-modules-by-category :editor)

;; Load completion modules immediately
(mcg-load-modules-by-category :completion)

;; Load tools modules immediately
(mcg-load-modules-by-category :tools)

;; Load input modules immediately
(mcg-load-modules-by-category :input)

;; Load Org modules immediately
(mcg-load-modules-by-category :org)

;; Load docs modules immediately
(mcg-load-modules-by-category :docs)

;; Setup lazy loading for language modules
;; LSP module loads immediately (other language modules depend on it)
(mcg-load-module :lang 'lsp)
(mcg-load-module :lang 'lsp-common)

;; Setup deferred loading for language modules
(mcg-setup-deferred-loading)

#+END_SRC

** Load Private Configuration
#+BEGIN_SRC emacs-lisp
;;; Load Private Configuration

(let ((private-config (expand-file-name "config.el" mcg-private-dir)))
  (when (file-exists-p private-config)
    (mcg-log "Loading private configuration...")
    (load private-config nil t)))

#+END_SRC

** Startup Complete
#+BEGIN_SRC emacs-lisp
;;; Startup Complete

;; Show module loading statistics
(add-hook 'emacs-startup-hook
          (lambda ()
            (let ((loaded (length mcg-loaded-modules))
                  (deferred (length mcg-deferred-modules))
                  (errors (length mcg-module-load-errors)))
              (mcg-log "Modules: %d loaded, %d deferred, %d errors"
                       loaded deferred errors)
              ;; Show warning if there are errors
              (when (> errors 0)
                (message "⚠️ %d module(s) failed to load. Run M-x mcg-list-modules for details."
                         errors)))))

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
(provide 'init)
;;; init.el ends here
#+END_SRC
