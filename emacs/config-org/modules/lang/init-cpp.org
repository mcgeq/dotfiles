* init-cpp.el
:PROPERTIES:
:HEADER-ARGS: :tangle init-cpp.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
;;; init-cpp.el --- C/C++ Development for MCG Emacs -*- lexical-binding: t; -*-

;; Filename: init-cpp.el
;; Description: C/C++ development module
;; Author: mcge <mcgeq@outlook.com>
;; Copyright (C) 2024-2026, mcge, all rights reserved.
;; Create   Date: 2026-01-07
;; Version: 3.0
;; Keywords: c, c++, cpp
;; Compatibility: GNU Emacs 29.0+

;;; Commentary:
;;
;; C/C++ development module for MCG Emacs, responsible for:
;; - C/C++ mode configuration
;; - Modern C++ font lock
;; - Qt keyword support
;; - LSP integration (clangd)
;;
;; Module metadata:
;; :depends (+lsp)
;; :defer t
;; :mode ("\\.c\\'" "\\.h\\'" "\\.cpp\\'" "\\.hpp\\'" "\\.cc\\'" "\\.cxx\\'")
;;

#+END_SRC

** Dependencies
#+BEGIN_SRC emacs-lisp
;;; Dependencies

(require 'core-lib)
(require 'cc-mode)

#+END_SRC

** Modern C++ Font Lock
#+BEGIN_SRC emacs-lisp
;;; Modern C++ Font Lock

(defun mcg--setup-modern-cpp-font-lock ()
  "Setup Modern C++ font lock."
  (when (mcg-require-extension "lang/modern-cpp-font-lock" 'modern-cpp-font-lock)
    (modern-c++-font-lock-global-mode 1)
    (mcg-log "Modern C++ font lock enabled")))

#+END_SRC

** C/C++ Mode Configuration
#+BEGIN_SRC emacs-lisp
;;; C/C++ Mode Configuration

(defun mcg--c-mode-style-setup ()
  "Setup C/C++ code style."
  ;; Use stroustrup style
  (c-set-style "stroustrup")
  
  ;; Indentation settings
  (setq c-basic-offset 4)
  (setq tab-width 4)
  (setq indent-tabs-mode nil)
  
  ;; Qt keyword support
  (setq c-protection-key
        (concat "\\<\\(public\\|public slot\\|protected"
                "\\|protected slot\\|private\\|private slot"
                "\\)\\>"))
  (setq c-C++-access-key
        (concat "\\<\\(signals\\|public\\|protected\\|private"
                "\\|public slots\\|protected slots\\|private slots"
                "\\)\\>[ \t]*:"))
  
  ;; Qt keyword fonts
  (font-lock-add-keywords
   'c++-mode
   '(("\\<\\(slots\\|signals\\)\\>" . font-lock-type-face)
     ("\\<Q_OBJECT\\>" . font-lock-keyword-face)
     ("\\<\\(SIGNAL\\|SLOT\\)\\>" . font-lock-keyword-face)
     ("\\<Q[A-Z][A-Za-z]*\\>" . font-lock-type-face))))

(defun mcg--c-mode-hook ()
  "C/C++ mode hook."
  (mcg--c-mode-style-setup)
  ;; LSP is handled by global-lsp-bridge-mode, no need to enable manually
  )

#+END_SRC

** Initialize
#+BEGIN_SRC emacs-lisp
;;; Initialize

(mcg--setup-modern-cpp-font-lock)

;; Add hooks
(add-hook 'c-mode-hook #'mcg--c-mode-hook)
(add-hook 'c++-mode-hook #'mcg--c-mode-hook)
(add-hook 'c-mode-common-hook #'mcg--c-mode-hook)

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
(provide 'init-cpp)
;;; init-cpp.el ends here
#+END_SRC
