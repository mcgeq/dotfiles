* init-org.el
:PROPERTIES:
:HEADER-ARGS: :tangle init-org.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
  ;;; init-org.el --- Org Mode Configuration for MCG Emacs -*- lexical-binding: t; -*-

  ;; Filename: init-org.el
  ;; Description: Org Mode é…ç½®æ¨¡å—
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024-2026, mcge, all rights reserved.
  ;; Create   Date: 2026-01-07
  ;; Version: 3.0
  ;; Keywords: org, notes, productivity
  ;; Compatibility: GNU Emacs 29.0+

  ;;; Commentary:
  ;;
  ;; MCG Emacs é…ç½®æ¶æ„çš„ Org Mode é…ç½®æ¨¡å—ï¼Œè´Ÿè´£ï¼š
  ;; - Org mode åŸºç¡€è®¾ç½®
  ;; - TODO å…³é”®è¯å’ŒçŠ¶æ€é…ç½®
  ;; - å¤–è§‚ç¾åŒ–ï¼ˆorg-superstar, org-appearï¼‰
  ;; - org-modern ç°ä»£åŒ–ç•Œé¢
  ;; - org-download å›¾ç‰‡ä¸‹è½½
  ;; - ä¸­æ–‡æ—¥å†é›†æˆ
  ;; - ç¬¦å·ç¾åŒ–
  ;;
  ;; æ¨¡å—å…ƒæ•°æ®:
  ;; :depends ()
  ;; :defer nil
  ;;

#+END_SRC

** Dependencies
#+BEGIN_SRC emacs-lisp
  ;;; Dependencies

  (require 'core-lib)
  (require 'org)
  (require 'ox)

#+END_SRC

** Variables
#+BEGIN_SRC emacs-lisp
  ;;; Variables

  (defgroup mcg-org nil
    "Org mode configuration variables."
    :group 'org
    :prefix "mcg-org-")

  ;;; åŸºç¡€ç›®å½•é…ç½®
  (defcustom mcg-org-directory
    (expand-file-name "~/org")
    "Org mode æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚"
    :type 'directory
    :group 'mcg-org)

  (defcustom mcg-org-agenda-directory
    (expand-file-name "agenda" mcg-org-directory)
    "Org agenda æ–‡ä»¶ç›®å½•ã€‚"
    :type 'directory
    :group 'mcg-org)

  (defcustom mcg-org-notes-directory
    (expand-file-name "notes" mcg-org-directory)
    "Org ç¬”è®°æ–‡ä»¶ç›®å½•ã€‚"
    :type 'directory
    :group 'mcg-org)

  (defcustom mcg-org-blog-directory
    (expand-file-name "blog" mcg-org-directory)
    "åšå®¢ç›¸å…³ Org æ–‡ä»¶ç›®å½•ã€‚"
    :type 'directory
    :group 'mcg-org)

  (defcustom mcg-org-archive-directory
    (expand-file-name "archive" mcg-org-directory)
    "Org å½’æ¡£æ–‡ä»¶ç›®å½•ã€‚"
    :type 'directory
    :group 'mcg-org)


  ;;; ä¸»è¦æ–‡ä»¶è·¯å¾„
  (defcustom mcg-org-default-notes-file
    (expand-file-name "notes.org" mcg-org-notes-directory)
    "é»˜è®¤ç¬”è®°æ–‡ä»¶ã€‚"
    :type 'file
    :group 'mcg-org)

  (defcustom mcg-org-task-file
    (expand-file-name "tasks.org" mcg-org-agenda-directory)
    "ä»»åŠ¡æ–‡ä»¶ã€‚"
    :type 'file
    :group 'mcg-org)

  ;;; åŠŸèƒ½å¼€å…³
  (defcustom mcg-org-enable-pretty-symbols t
    "æ˜¯å¦å¯ç”¨ Org mode ç¾åŒ–ç¬¦å·ã€‚"
    :type 'boolean
    :group 'mcg-org)

  (defcustom mcg-org-enable-mixed-pitch nil
    "æ˜¯å¦å¯ç”¨æ··åˆå­—ä½“ï¼ˆè¡¬çº¿+ç­‰å®½ï¼‰ã€‚"
    :type 'boolean
    :group 'mcg-org)

  (defcustom mcg-org-enable-visual-fill nil
    "æ˜¯å¦å¯ç”¨è§†è§‰å¡«å……åˆ—ã€‚"
    :type 'boolean
    :group 'mcg-org)

  (defcustom mcg-org-enable-chinese-calendar t
    "æ˜¯å¦å¯ç”¨ä¸­æ–‡æ—¥å†ã€‚"
    :type 'boolean
    :group 'mcg-org)

  (defcustom mcg-org-enable-org-modern t
    "æ˜¯å¦å¯ç”¨ org-modern ç°ä»£åŒ–ç•Œé¢ã€‚"
    :type 'boolean
    :group 'mcg-org)

  (defcustom mcg-org-visual-fill-width 88
    "Visual fill column å®½åº¦ã€‚"
    :type 'integer
    :group 'mcg-org)

#+END_SRC

** Directory Helpers
#+BEGIN_SRC emacs-lisp
  ;;; Directory Helpers

  (defun mcg-org-ensure-directory (dir)
    "ç¡®ä¿ç›®å½• DIR å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºã€‚"
    (unless (file-exists-p dir)
      (make-directory dir t)
      (mcg-log "Created directory: %s" dir)))

  (defun mcg-org-initialize-directories ()
    "åˆå§‹åŒ–æ‰€æœ‰ Org mode ç›®å½•ã€‚"
    (interactive)
    (mapc #'mcg-org-ensure-directory
          (list mcg-org-directory
                mcg-org-agenda-directory
                mcg-org-notes-directory
                mcg-org-blog-directory
                mcg-org-archive-directory)))

#+END_SRC

** Basic Settings
#+BEGIN_SRC emacs-lisp
  ;;; Basic Settings

  (defun mcg-org-setup-basic ()
    "è®¾ç½® Org mode åŸºç¡€é…ç½®ã€‚"
    (setq org-ellipsis " â­"
          org-tags-column 0
          org-log-into-drawer t
          org-pretty-entities t
          org-startup-indented t
          org-hide-leading-stars nil
          org-hide-emphasis-markers t
          org-image-actual-width '(800)
          org-startup-with-inline-images t
          org-indent-mode-turns-on-hiding-stars nil)

    ;; å®Œæˆä»»åŠ¡æ—¶è®°å½•æ—¶é—´
    (setq org-log-done 'time)

    ;; æ—¥å¿—è®°å½•é…ç½®
    (setq org-log-repeat 'time
          org-log-redeadline 'note
          org-log-reschedule 'note
          org-log-into-drawer t
          org-log-state-notes-insert-after-drawers nil)

    (mcg-log "Configured org basic settings"))

#+END_SRC


** TODO Keywords
#+BEGIN_SRC emacs-lisp
  ;;; TODO Keywords

  (defun mcg-org-setup-todo-keywords ()
    "è®¾ç½® TODO å…³é”®è¯å’ŒçŠ¶æ€ã€‚"
    ;; TODO çš„å…³é”®è¯è®¾ç½®
    (setq org-todo-keywords '((sequence
                               "TODO(t)"
                               "HOLD(h!)"
                               "WIP(i!)"
                               "WAIT(w!)"
                               "|"
                               "DONE(d!)"
                               "CANCELLED(c@/!)")
                              (sequence
                               "REPORT(r)"
                               "BUG(b)"
                               "KNOWNCAUSE(k)"
                               "|"
                               "FIXED(f!)")))

    ;; TODO å…³é”®è¯çš„æ ·å¼è®¾ç½®
    (setq org-todo-keyword-faces '(("TODO"       :foreground "#7c7c75" :weight bold)
                                   ("HOLD"       :foreground "#feb24c" :weight bold)
                                   ("WIP"        :foreground "#0098dd" :weight bold)
                                   ("WAIT"       :foreground "#9f7efe" :weight bold)
                                   ("DONE"       :foreground "#50a14f" :weight bold)
                                   ("CANCELLED"  :foreground "#ff6480" :weight bold)
                                   ("REPORT"     :foreground "magenta" :weight bold)
                                   ("BUG"        :foreground "red"     :weight bold)
                                   ("KNOWNCAUSE" :foreground "yellow"  :weight bold)
                                   ("FIXED"      :foreground "green"   :weight bold)))

    ;; çŠ¶æ€å˜åŒ–æ—¶æ ‡ç­¾åŒæ­¥
    (setq org-todo-state-tags-triggers
          (quote (("CANCELLED" ("CANCELLED" . t))
                  ("WAIT" ("WAIT" . t))
                  ("HOLD" ("WAIT") ("HOLD" . t))
                  (done ("WAIT") ("HOLD"))
                  ("TODO" ("WAIT") ("CANCELLED") ("HOLD"))
                  ("DONE" ("WAIT") ("CANCELLED") ("HOLD")))))

    (mcg-log "Configured org TODO keywords"))

#+END_SRC

** Appearance
#+BEGIN_SRC emacs-lisp
  ;;; Appearance

  (defun mcg-org-setup-appearance ()
    "è®¾ç½® Org mode å¤–è§‚ã€‚"
    ;; æ ‡é¢˜å±‚çº§å­—ä½“å¤§å°
    (custom-set-faces
     '(org-level-1 ((t (:height 1.15))))
     '(org-level-2 ((t (:height 1.13))))
     '(org-level-3 ((t (:height 1.11))))
     '(org-level-4 ((t (:height 1.09))))
     '(org-level-5 ((t (:height 1.07))))
     '(org-level-6 ((t (:height 1.05))))
     '(org-level-7 ((t (:height 1.03))))
     '(org-level-8 ((t (:height 1.01))))
     '(org-tag ((t (:inherit 'fixed-pitch))))
     '(org-date ((t (:inherit 'fixed-pitch))))
     '(org-todo ((t (:inherit 'fixed-pitch))))
     '(org-done ((t (:inherit 'fixed-pitch))))
     '(org-drawer ((t (:inherit 'fixed-pitch))))
     '(org-ellipsis ((t (:inherit 'fixed-pitch))))
     '(org-property-value ((t (:inherit 'fixed-pitch))))
     '(org-special-keyword ((t (:inherit 'fixed-pitch))))
     '(org-headline-done ((t (:inherit 'variable-pitch)))))

    ;; åˆ—è¡¨ç¬¦å·ç¾åŒ–
    (with-eval-after-load 'org
      (setq line-spacing 0.25)
      (setq org-list-demote-modify-bullet
            '(("+" . "-") ("-" . "+") ("*" . "+") ("1." . "a."))))

    (font-lock-add-keywords
     'org-mode
     '(("^ +\\([-*]\\) "
        (0 (prog1 () (compose-region (match-beginning 1) (match-end 1) "â–»"))))))

    (mcg-log "Configured org appearance"))

#+END_SRC


** Org Superstar
#+BEGIN_SRC emacs-lisp
  ;;; Org Superstar

  (defun mcg-org-setup-superstar ()
    "è®¾ç½® org-superstar æ ‡é¢˜ç¾åŒ–ã€‚"
    (when (mcg-require-extension "org/org-superstar-mode" 'org-superstar)
      (setq org-superstar-leading-bullet ?\s
            org-superstar-special-todo-items t
            org-superstar-item-bullet-alist '((43 . "â—†") (45 . "â–¸"))
            org-superstar-headline-bullets-list '("â—‰" "â—‹" "âœ¸" "âœ¿" "âœ¤" "âœœ" "â—†" "â–¶"))

      (custom-set-faces
       '(org-superstar-item ((t (:inherit 'fixed-pitch))))
       '(org-superstar-header-bullet ((t (:height 232 :inherit 'fixed-pitch)))))

      (mcg-log "Configured org-superstar")))

#+END_SRC

** Org Appear
#+BEGIN_SRC emacs-lisp
  ;;; Org Appear

  (defun mcg-org-setup-appear ()
    "è®¾ç½® org-appear è‡ªåŠ¨æ˜¾ç¤ºæ ‡è®°ã€‚"
    (when (mcg-require-extension "org/org-appear" 'org-appear)
      (mcg-log "Configured org-appear")))

#+END_SRC

** Org Modern
#+BEGIN_SRC emacs-lisp
  ;;; Org Modern

  (defun mcg-org-setup-modern ()
    "è®¾ç½® org-modern ç°ä»£åŒ–ç•Œé¢ã€‚"
    (when (and mcg-org-enable-org-modern
               (mcg-require-extension "org/org-modern" 'org-modern))
      ;; org-modern é…ç½®
      (setq org-modern-star '("â—‰" "â—‹" "âœ¸" "âœ¿" "âœ¤" "âœœ" "â—†" "â–¶")
            org-modern-table-vertical 1
            org-modern-table-horizontal 0.2
            org-modern-list '((43 . "â—†") (45 . "â–¸") (42 . "â€¢"))
            org-modern-todo-faces
            '(("TODO" :inverse-video t :inherit org-todo)
              ("HOLD" :inverse-video t :inherit +org-todo-onhold)
              ("WIP" :inverse-video t :inherit +org-todo-active)
              ("WAIT" :inverse-video t :inherit +org-todo-onhold)
              ("DONE" :inverse-video t :inherit org-done)
              ("CANCELLED" :inverse-video t :inherit +org-todo-cancel))
            org-modern-priority-faces
            '((?A :inverse-video t :inherit org-priority)
              (?B :inverse-video t :inherit org-priority)
              (?C :inverse-video t :inherit org-priority))
            org-modern-block-fringe nil
            org-modern-block-name
            '((t . t)
              ("src" "Â»" "Â«")
              ("example" "Â»â€“" "â€“Â«")
              ("quote" "â" "â")))

      (mcg-log "Configured org-modern")))

#+END_SRC

** Org Download
#+BEGIN_SRC emacs-lisp
  ;;; Org Download

  (defun mcg-org-setup-download ()
    "è®¾ç½® org-download å›¾ç‰‡ä¸‹è½½ã€‚"
    (when (mcg-require-extension "org/org-download" 'org-download)
      ;; Drag-and-drop to dired
      (add-hook 'dired-mode-hook 'org-download-enable)
      (add-hook 'org-mode-hook 'org-download-enable)

      (setq org-download-display-inline-images 'posframe)

      (mcg-log "Configured org-download")))

  (defun mcg/org-insert-clipboard-image (width)
    "ä»å‰ªè´´æ¿æ’å…¥å›¾ç‰‡åˆ° Org æ–‡ä»¶ã€‚
  WIDTH æ˜¯å›¾ç‰‡å®½åº¦ï¼Œé»˜è®¤ 800ã€‚"
    (interactive (list
                  (read-string (format "Input image width, default is 800: ")
                               nil nil "800")))
    ;; è®¾ç½®å›¾ç‰‡å­˜æ”¾çš„æ–‡ä»¶å¤¹ä½ç½®ä¸º `å½“å‰ Org æ–‡ä»¶åŒå.assets'
    (let* ((foldername (concat (file-name-base (buffer-file-name)) ".assets/"))
           (imgName (concat "img_" (format-time-string "%Y%m%d_%H%M%S") ".png"))
           (relativeFilename (concat (file-name-base (buffer-name)) ".assets/" imgName)))

      (unless (file-exists-p foldername)
        (mkdir foldername))

      ;; æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿè®¾ç½®ä¸åŒçš„å‘½ä»¤è¡Œå·¥å…·
      (cond
       ((eq system-type 'windows-nt)
        (setq org-download-screenshot-method (concat "magick clipboard: " relativeFilename)))
       ((eq system-type 'gnu/linux)
        (setq org-download-screenshot-method (concat "xclip -selection clipboard -t image/png -o > " relativeFilename)))
       ((eq system-type 'darwin)
        (setq org-download-screenshot-method (concat "pngpaste " relativeFilename))))

      ;; ç»™ç²˜è´´å¥½çš„å›¾ç‰‡é“¾æ¥åŠ ä¸Šå®½åº¦å±æ€§
      (insert (concat "\n#+DOWNLOADED: screenshot @ "
                      (format-time-string "%Y-%m-%d %a %H:%M:%S" (current-time))
                      "\n#+CAPTION: \n#+ATTR_ORG: :width "
                      width
                      "\n#+ATTR_LATEX: :width "
                      (if (>= (/ (string-to-number width) 800.0) 1.0)
                          "1.0"
                        (number-to-string (/ (string-to-number width) 800.0)))
                      "\\linewidth :float nil\n"
                      "#+ATTR_HTML: :width "
                      width
                      "\n[[file:" relativeFilename "]]\n"))
      (when (fboundp 'org-download-screenshot)
        (org-download-screenshot))))

#+END_SRC


** Visual Fill Column
#+BEGIN_SRC emacs-lisp
  ;;; Visual Fill Column

  (defun mcg-org-setup-visual-fill ()
    "è®¾ç½® visual-fill-columnã€‚"
    (when (and mcg-org-enable-visual-fill
               (mcg-require-extension "org/visual-fill-column" 'visual-fill-column))
      (setq visual-fill-column-width mcg-org-visual-fill-width)
      (mcg-log "Configured visual-fill-column")))

#+END_SRC

** Mixed Pitch
#+BEGIN_SRC emacs-lisp
  ;;; Mixed Pitch

  (defun mcg-org-setup-mixed-pitch ()
    "è®¾ç½® mixed-pitch æ··åˆå­—ä½“ã€‚"
    (when (and mcg-org-enable-mixed-pitch
               (mcg-require-extension "org/mixed-pitch" 'mixed-pitch))
      ;; å­—ä½“é…ç½®ï¼ˆå¸¦å¯ç”¨æ€§æ£€æŸ¥ï¼‰
      (when (display-graphic-p)
        (let ((mono-font (cond
                          ((find-font (font-spec :name "FiraCode Nerd Font Mono"))
                           "FiraCode Nerd Font Mono")
                          ((find-font (font-spec :name "Consolas"))
                           "Consolas")
                          (t "monospace")))
              (serif-font (cond
                           ((find-font (font-spec :name "Noto Serif"))
                            "Noto Serif")
                           ((find-font (font-spec :name "Georgia"))
                            "Georgia")
                           (t "serif"))))
          (custom-set-faces
           `(default ((t (:font ,mono-font))))
           `(fixed-pitch ((t (:font ,mono-font :height 1.0))))
           `(variable-pitch ((t (:font ,serif-font :height 1.0)))))))
      (mcg-log "Configured mixed-pitch")))

#+END_SRC

** Chinese Calendar
#+BEGIN_SRC emacs-lisp
  ;;; Chinese Calendar

  (defun mcg-org-setup-chinese-calendar ()
    "è®¾ç½®ä¸­æ–‡æ—¥å†ã€‚"
    (when (and mcg-org-enable-chinese-calendar
               (mcg-require-extension "org/cal-china-x" 'cal-china-x))
      (with-eval-after-load 'calendar
        ;; è®¾ç½®æ ‡è®°ä»Šå¤©
        (add-hook 'calendar-today-visible-hook 'calendar-mark-today)

        ;; æ—¥å†åŸºç¡€è®¾ç½®
        (setq calendar-chinese-all-holidays-flag nil
              calendar-mark-holidays-flag t
              calendar-mark-diary-entries-flag nil
              calendar-time-zone-style 'numeric
              calendar-date-style 'iso)

        ;; è®¾ç½®ä¸­æ–‡å¤©å¹²åœ°æ”¯
        (setq calendar-chinese-celestial-stem
              ["ç”²" "ä¹™" "ä¸™" "ä¸" "æˆŠ" "å·±" "åºš" "è¾›" "å£¬" "ç™¸"])
        (setq calendar-chinese-terrestrial-branch
              ["å­" "ä¸‘" "å¯…" "å¯" "è¾°" "å·³" "åˆ" "æœª" "ç”³" "é…‰" "æˆŒ" "äº¥"])

        ;; è®¾ç½®ä¸­æ–‡æœˆä»½åç§°
        (setq calendar-month-name-array
              ["ä¸€æœˆ" "äºŒæœˆ" "ä¸‰æœˆ" "å››æœˆ" "äº”æœˆ" "å…­æœˆ"
               "ä¸ƒæœˆ" "å…«æœˆ" "ä¹æœˆ" "åæœˆ" "åä¸€æœˆ" "åäºŒæœˆ"])

        ;; è®¾ç½®æ˜ŸæœŸæ ‡é¢˜æ˜¾ç¤º
        (setq calendar-day-name-array
              ["æ—¥" "ä¸€" "äºŒ" "ä¸‰" "å››" "äº”" "å…­"])

        ;; è®¾ç½®å‘¨ä¸€ä¸ºä¸€å‘¨çš„ç¬¬ä¸€å¤©
        (setq calendar-week-start-day 1))

      ;; è‡ªåŠ¨åˆå§‹åŒ– cal-china-x
      (add-hook 'after-init-hook 'cal-china-x-setup)

      (mcg-log "Configured Chinese calendar")))

#+END_SRC

** Prettify Symbols
#+BEGIN_SRC emacs-lisp
  ;;; Prettify Symbols

  (defun mcg/org-prettify-symbols ()
    "è®¾ç½® Org mode ç¬¦å·ç¾åŒ–ã€‚"
    (setq prettify-symbols-alist
          (mapcan (lambda (x) (list x (cons (upcase (car x)) (cdr x))))
                  '(("#+begin_src"      . "â†ª")
                    ("#+end_src"        . "â†©")
                    ("#+begin_example"  . 129083)
                    ("#+end_example"    . 129081)
                    ("#+results:"       . 9776)
                    ("#+attr_latex:"    . "ğŸ„›")
                    ("#+attr_html:"     . "ğŸ„—")
                    ("#+attr_org:"      . "ğŸ„")
                    ("#+name:"          . "ğŸ„")
                    ("#+caption:"       . "ğŸ„’")
                    ("#+date:"          . "ğŸ“…")
                    ("#+author:"        . "ğŸ’")
                    ("#+setupfile:"     . 128221)
                    ("#+email:"         . 128231)
                    ("#+startup:"       . 10034)
                    ("#+options:"       . 9965)
                    ("#+title:"         . 10162)
                    ("#+subtitle:"      . 11146)
                    ("#+downloaded:"    . 8650)
                    ("#+language:"      . 128441)
                    ("#+begin_quote"    . 187)
                    ("#+end_quote"      . 171)
                    ("#+begin_results"  . 8943)
                    ("#+end_results"    . 8943)
                    (":PROPERTIES:"     . "â¥¼")
                    (":HEADER-ARGS:"    . "Ğ­")
                    (":END:"            . "â¥½"))))
    (setq prettify-symbols-unprettify-at-point t)
    (prettify-symbols-mode 1))

#+END_SRC


** Chinese-English Spacing
#+BEGIN_SRC emacs-lisp
  ;;; Chinese-English Spacing

  (defun mcg-org-setup-chinese-spacing ()
    "è®¾ç½®ä¸­è‹±æ–‡æ··æ’ç©ºæ ¼å¤„ç†ã€‚"
    ;; è§£å†³ä¸­æ–‡æ ‡è®°å‰åç©ºæ ¼çš„é—®é¢˜
    (font-lock-add-keywords
     'org-mode
     '(("\\cc\\( \\)[/+*_=~][^a-zA-Z0-9]*?[/+*_=~]\\( \\)?\\cc?"
        (1 (prog1 () (compose-region (match-beginning 1) (match-end 1) ""))))
       ("\\cc?\\( \\)?[/+*_=~][^a-zA-Z0-9]*?[/+*_=~]\\( \\)\\cc"
        (2 (prog1 () (compose-region (match-beginning 2) (match-end 2) "")))))
     'append)

    (with-eval-after-load 'org
      (defun mcg-org--strip-ws-maybe (text _backend _info)
        "å¤„ç†å¯¼å‡ºæ—¶çš„ä¸­è‹±æ–‡ç©ºæ ¼ã€‚"
        (let* ((text (replace-regexp-in-string
                      "\\(\\cc\\) *\n *\\(\\cc\\)"
                      "\\1\\2" text))
               (text (replace-regexp-in-string
                      "\\(\\cc\\) \\(.*?\\) \\(\\cc\\)"
                      "\\1\\2\\3" text))
               (text (replace-regexp-in-string
                      "\\(\\cc\\)\\(\\(?:<[^>]+>\\)?[a-z0-9A-Z-]+\\(?:<[^>]+>\\)?\\)\\(\\cc\\)"
                      "\\1 \\2 \\3" text)))
          text))
      (add-to-list 'org-export-filter-paragraph-functions #'mcg-org--strip-ws-maybe))

    (mcg-log "Configured Chinese-English spacing"))

#+END_SRC

** Time Stamp Format
#+BEGIN_SRC emacs-lisp
  ;;; Time Stamp Format

  (defun mcg-org-setup-timestamp ()
    "è®¾ç½®æ—¶é—´æˆ³æ ¼å¼ã€‚"
    ;; è®¾ç½®æ—¶é—´æˆ³æ ¼å¼ä¸º [2025-12-08 å‘¨ä¸€ 10:21:23]
    (setq org-time-stamp-custom-formats
          '("<%Y-%m-%d %A %H:%M:%S>" . "<%Y-%m-%d %A %H:%M:%S>"))

    ;; è®¾ç½®ä¸­æ–‡æ˜ŸæœŸæ˜¾ç¤º
    (setq system-time-locale "zh_CN.UTF-8")

    ;; ä½¿ç”¨è‡ªå®šä¹‰æ—¶é—´æ ¼å¼
    (setq org-display-custom-times t)

    (mcg-log "Configured timestamp format"))

#+END_SRC

** Export Configuration
#+BEGIN_SRC emacs-lisp
  ;;; Export Configuration

  (defun mcg-org-setup-export ()
    "è®¾ç½®å¯¼å‡ºé…ç½®ã€‚"
    (with-eval-after-load 'org
      (require 'ox-gfm nil t)
      (add-to-list 'org-export-backends 'md)
      (when (featurep 'ox-gfm)
        (add-to-list 'org-export-backends 'gfm)))

    (mcg-log "Configured org export"))

#+END_SRC

** Org Mode Hook
#+BEGIN_SRC emacs-lisp
  ;;; Org Mode Hook

  (defun mcg-org-mode-setup ()
    "Org mode åˆå§‹åŒ–è®¾ç½®ã€‚"
    (setq-local line-spacing 2)
    (visual-line-mode 1)

    ;; æŒ‰éœ€å¯ç”¨åŠŸèƒ½
    (when mcg-org-enable-visual-fill
      (when (fboundp 'visual-fill-column-mode)
        (visual-fill-column-mode 1)))

    (when mcg-org-enable-mixed-pitch
      (when (fboundp 'mixed-pitch-mode)
        (mixed-pitch-mode 1)))

    ;; org-superstar
    (when (fboundp 'org-superstar-mode)
      (org-superstar-mode 1))

    ;; org-appear
    (when (fboundp 'org-appear-mode)
      (org-appear-mode 1))

    ;; org-modern
    (when (and mcg-org-enable-org-modern
               (fboundp 'org-modern-mode))
      (org-modern-mode 1))

    ;; ç¾åŒ–ç¬¦å·
    (when mcg-org-enable-pretty-symbols
      (mcg/org-prettify-symbols)))

#+END_SRC

** Commands
#+BEGIN_SRC emacs-lisp
  ;;; Commands

  (defun mcg/org-toggle-modern ()
    "åˆ‡æ¢ org-modern æ¨¡å¼ã€‚"
    (interactive)
    (if (bound-and-true-p org-modern-mode)
        (org-modern-mode -1)
      (org-modern-mode 1))
    (message "Org-modern mode: %s"
             (if (bound-and-true-p org-modern-mode) "enabled" "disabled")))

  (defun mcg/org-toggle-pretty-symbols ()
    "åˆ‡æ¢ç¬¦å·ç¾åŒ–ã€‚"
    (interactive)
    (if prettify-symbols-mode
        (prettify-symbols-mode -1)
      (mcg/org-prettify-symbols))
    (message "Prettify symbols: %s"
             (if prettify-symbols-mode "enabled" "disabled")))

  (defun mcg/org-open-notes ()
    "æ‰“å¼€ç¬”è®°ç›®å½•ã€‚"
    (interactive)
    (find-file mcg-org-notes-directory))

  (defun mcg/org-open-agenda-dir ()
    "æ‰“å¼€ agenda ç›®å½•ã€‚"
    (interactive)
    (find-file mcg-org-agenda-directory))

#+END_SRC

** Initialize
#+BEGIN_SRC emacs-lisp
  ;;; Initialize

  ;; åˆå§‹åŒ–ç›®å½•
  (mcg-org-initialize-directories)

  ;; è®¾ç½®åŸºç¡€é…ç½®
  (mcg-org-setup-basic)
  (mcg-org-setup-todo-keywords)
  (mcg-org-setup-appearance)
  (mcg-org-setup-timestamp)
  (mcg-org-setup-export)
  (mcg-org-setup-chinese-spacing)

  ;; è®¾ç½®æ‰©å±•åŠŸèƒ½
  (mcg-org-setup-superstar)
  (mcg-org-setup-appear)
  (mcg-org-setup-modern)
  (mcg-org-setup-download)
  (mcg-org-setup-visual-fill)
  (mcg-org-setup-mixed-pitch)
  (mcg-org-setup-chinese-calendar)

  ;; æ·»åŠ  hook
  (add-hook 'org-mode-hook #'mcg-org-mode-setup)

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
  (provide 'init-org)
  ;;; init-org.el ends here
#+END_SRC
