#+TITLE: Auto Save Module
#+AUTHOR: mcge
#+PROPERTY: header-args:emacs-lisp :tangle init-blink-search.el :lexical t

* Auto Save Module

** File Header

#+begin_src emacs-lisp
;;; init-blink-search.el --- Blink-search configuration -*- lexical-binding: t; -*-

;;; Commentary:
;; Configure blink-search from:
;; emacs/site-lisp/extensions/search/blink-search

;;; Code:

(require 'core-lib)
#+end_src

** Custom Options

#+begin_src emacs-lisp
;;; ============================================================
;;; Blink-Search Configuration
;;; ============================================================

(defun mcg--setup-blink-search ()
  "Setup Blink-search fast search framework."
  (when (mcg-require-extension "blink-search" t)
    ;; Common directories
    (setq blink-search-common-directory
          `(("HOME" "~/")
            ("CONFIG" ,mcg-config-dir)
            ("DOWNLOADS" "~/Downloads/")
            ("DOCUMENTS" "~/Documents/")
            ("DESKTOP" "~/Desktop/")))

    ;; Python command
    (setq blink-search-python-command
          (if (memq system-type '(cygwin windows-nt ms-dos))
              "python.exe"
            "python3"))

    ;; Display settings
    (setq blink-search-enable-icon t)
    (setq blink-search-enable-posframe t)
    (setq blink-search-posframe-width-ratio 0.8)
    (setq blink-search-posframe-height-ratio 0.6)
    (setq blink-search-posframe-standalone nil)
    (setq blink-search-flash-line-delay 0.3)

    ;; Search backends (nil = use all backends)
    (setq blink-search-search-backends nil)

    ;; File manager
    (setq blink-search-file-manager 'dired)

    ;; History file path
    (setq blink-search-history-path
          (expand-file-name "blink-search/history.txt" user-emacs-directory))

    ;; Database path
    (setq blink-search-db-path
          (expand-file-name "blink-search.db" user-emacs-directory))
    (setq blink-search-db-table "kvstore")

    ;; Debug settings
    (setq blink-search-enable-debug nil)
    (setq blink-search-enable-log nil)

    (mcg-log "Blink-search configured")))
#+end_src

** Blink-Search Helper Functions

Blink-search 辅助函数。

*** Search in Current Directory

#+begin_src emacs-lisp
;;; ============================================================
;;; Blink-Search Helper Functions
;;; ============================================================

(defun mcg/blink-search-grep-current-dir ()
  "Search files in current directory using blink-search."
  (interactive)
  (let ((default-directory (or (when buffer-file-name
                                 (file-name-directory buffer-file-name))
                               default-directory)))
    (blink-search)))
#+end_src

*** Search in Project Root

#+begin_src emacs-lisp
(defun mcg/blink-search-project-root ()
  "Search files in project root using blink-search."
  (interactive)
  (let* ((project-root (or (and (fboundp 'projectile-project-root)
                                (projectile-project-root))
                           (and (fboundp 'project-root)
                                (when-let ((project (project-current)))
                                  (project-root project)))
                           default-directory))
         (default-directory project-root))
    (blink-search)))
#+end_src

#+begin_src emacs-lisp
;;; ============================================================
;;; Keybindings (C-c s prefix)
;;; ============================================================

(defun mcg--setup-search-keybindings ()
  "Setup search related keybindings."
  ;; Blink-search
  (when (featurep 'blink-search)
    (global-set-key (kbd "C-c s B") 'blink-search)
    (global-set-key (kbd "C-c s D") 'mcg/blink-search-grep-current-dir)
    (global-set-key (kbd "C-c s P") 'mcg/blink-search-project-root))

    (mcg-log "Search keybindings configured"))
#+end_src

** Initialize

#+begin_src emacs-lisp
  (mcg--setup-blink-search)
  (mcg--setup-search-keybindings)
#+end_src

** Provide

#+begin_src emacs-lisp
(provide 'init-blink-search)
;;; init-blink-search.el ends here
#+end_src

