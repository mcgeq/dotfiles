* init-theme.el
:PROPERTIES:
:HEADER-ARGS: :tangle init-theme.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
  ;;; init-theme.el --- Theme Configuration for MCG Emacs -*- lexical-binding: t; -*-

  ;; Filename: init-theme.el
  ;; Description: Theme configuration module
  ;; Author: mcge <mcgeq@outlook.com>
  ;; Copyright (C) 2024-2026, mcge, all rights reserved.
  ;; Create   Date: 2026-01-07
  ;; Version: 3.0
  ;; Keywords: theme, ui, appearance
  ;; Compatibility: GNU Emacs 29.0+

  ;;; Commentary:
  ;;
  ;; Theme module for MCG Emacs configuration, responsible for:
  ;; - ef-themes configuration
  ;; - Theme switching commands
  ;; - nerd-icons configuration
  ;;
  ;; Module metadata:
  ;; :depends ()
  ;; :defer nil
  ;;

#+END_SRC

** Dependencies
#+BEGIN_SRC emacs-lisp
;;; Dependencies

(require 'core-lib)

#+END_SRC

** Variables
#+BEGIN_SRC emacs-lisp
;;; Variables

(defvar mcg-ui-default-theme 'ef-dream
  "Default theme.")

(defvar mcg-ui-light-theme 'ef-summer
  "Light/day theme.")

(defvar mcg-ui-dark-theme 'ef-bio
  "Dark/night theme.")

(defvar mcg-ui-auto-switch-theme nil
  "Whether to auto-switch theme based on time.
When set to t, uses dark theme after 18:00, otherwise uses light theme.")

(defvar mcg-ui-theme-switch-hour 18
  "Theme switch hour.
When `mcg-ui-auto-switch-theme' is t,
uses dark theme after this hour.")

#+END_SRC

** Theme Configuration
#+BEGIN_SRC emacs-lisp
;;; Theme Configuration

(defun mcg--load-ef-themes ()
  "Load ef-themes extension."
  (mcg-require-extension "ui/themes" 'ef-themes))

(defun mcg--select-theme ()
  "Select theme to load based on configuration."
  (if mcg-ui-auto-switch-theme
      (if (>= (string-to-number (format-time-string "%H"))
              mcg-ui-theme-switch-hour)
          mcg-ui-dark-theme
        mcg-ui-light-theme)
    mcg-ui-default-theme))

(defun mcg-ui-setup-theme ()
  "Set up theme."
  (when (mcg--load-ef-themes)
    (let ((theme (mcg--select-theme)))
      (load-theme theme t)
      (mcg-log "Loaded theme: %s" theme))))

#+END_SRC

** Theme Commands
#+BEGIN_SRC emacs-lisp
;;; Theme Commands

(defun mcg/switch-theme ()
  "Interactively switch theme.
Uses completing-read to select from ef-themes."
  (interactive)
  (when (mcg--load-ef-themes)
    (let* ((themes (custom-available-themes))
           (ef-themes (seq-filter (lambda (t)
                                    (string-prefix-p "ef-" (symbol-name t)))
                                  themes))
           (theme (intern (completing-read "Select theme: "
                                           (mapcar #'symbol-name ef-themes)
                                           nil t))))
      (mapc #'disable-theme custom-enabled-themes)
      (load-theme theme t)
      (mcg-log "Switched to theme: %s" theme)
      (message "Theme: %s" theme))))

(defun mcg/toggle-dark-light ()
  "Toggle between light and dark themes."
  (interactive)
  (when (mcg--load-ef-themes)
    (let* ((current (car custom-enabled-themes))
           (is-dark (and current
                         (string-match-p "dark\\|night\\|bio\\|dream"
                                         (symbol-name current))))
           (new-theme (if is-dark
                          mcg-ui-light-theme
                        mcg-ui-dark-theme)))
      (mapc #'disable-theme custom-enabled-themes)
      (load-theme new-theme t)
      (mcg-log "Toggled to theme: %s" new-theme)
      (message "Theme: %s" new-theme))))

(defun mcg/reload-theme ()
  "Reload current theme."
  (interactive)
  (let ((current (car custom-enabled-themes)))
    (when current
      (mapc #'disable-theme custom-enabled-themes)
      (load-theme current t)
      (message "Reloaded theme: %s" current))))

#+END_SRC

** Nerd Icons Configuration
#+BEGIN_SRC emacs-lisp
;;; Nerd Icons Configuration

(defvar mcg-ui-icon-font-family "FiraCode Nerd Font"
  "Icon font family name.")

(defun mcg-ui-setup-nerd-icons ()
  "Set up nerd-icons.
Path is already added to load-path by core-bootstrap's mcg-setup-load-path."
  (require 'nerd-icons nil t)
  
  (when (featurep 'nerd-icons)
    ;; Set icon font
    (setq nerd-icons-font-family mcg-ui-icon-font-family)
    
    ;; Load nerd-icons-completion
    (require 'nerd-icons-completion nil t)
    
    (when (featurep 'nerd-icons-completion)
      (nerd-icons-completion-mode 1)
      (add-hook 'marginalia-mode-hook #'nerd-icons-completion-marginalia-setup)
      (mcg-log "nerd-icons-completion configured")))
  
  (mcg-log "nerd-icons configured"))

#+END_SRC

** Initialize
#+BEGIN_SRC emacs-lisp
;;; Initialize

;; Set up theme
(mcg-ui-setup-theme)

;; Set up icons
(mcg-ui-setup-nerd-icons)

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
(provide 'init-theme)
;;; init-theme.el ends here
#+END_SRC
