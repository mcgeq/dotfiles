#+TITLE: Theme Module
#+AUTHOR: mcge
#+PROPERTY: header-args:emacs-lisp :tangle init-theme.el :lexical t

* Theme Module

本模块负责 MCG Emacs 的主题配置，包括：
- ef-themes 主题配置
- 主题切换命令
- 自动主题切换功能

** File Header

#+begin_src emacs-lisp
;;; init-theme.el --- Theme Configuration for MCG Emacs -*- lexical-binding: t; -*-

;; Filename: init-theme.el
;; Description: Theme configuration module
;; Author: mcge <mcgeq@outlook.com>
;; Copyright (C) 2024-2026, mcge, all rights reserved.
;; Create   Date: 2026-01-07
;; Version: 3.0
;; Keywords: theme, ui, appearance
;; Compatibility: GNU Emacs 29.0+

;;; Commentary:
;;
;; Theme module for MCG Emacs configuration, responsible for:
;; - ef-themes configuration
;; - Theme switching commands
;;
;; Module metadata:
;; :depends ()
;; :defer nil
;;
#+end_src

** Require

#+begin_src emacs-lisp
;;; Code:

;;; Dependencies

(require 'core-lib)
#+end_src

** Variables

主题相关的配置变量。

#+begin_src emacs-lisp
;;; Variables

(defvar mcg-ui-default-theme 'ef-dream
  "Default theme.")

(defvar mcg-ui-light-theme 'ef-summer
  "Light/day theme.")

(defvar mcg-ui-dark-theme 'ef-bio
  "Dark/night theme.")

(defvar mcg-ui-auto-switch-theme nil
  "Whether to auto-switch theme based on time.
When set to t, uses dark theme after 18:00, otherwise uses light theme.")

(defvar mcg-ui-theme-switch-hour 18
  "Theme switch hour.
When `mcg-ui-auto-switch-theme' is t,
uses dark theme after this hour.")
#+end_src

** Theme Configuration

主题加载和选择的核心函数。

#+begin_src emacs-lisp
;;; Theme Configuration

(defun mcg--load-ef-themes ()
  "Load ef-themes extension."
  (mcg-require-extension "ef-themes" t))

(defun mcg--select-theme ()
  "Select theme to load based on configuration."
  (if mcg-ui-auto-switch-theme
      (if (>= (string-to-number (format-time-string "%H"))
              mcg-ui-theme-switch-hour)
          mcg-ui-dark-theme
        mcg-ui-light-theme)
    mcg-ui-default-theme))

(defun mcg-ui-setup-theme ()
  "Set up theme."
  (when (mcg--load-ef-themes)
    (let ((theme (mcg--select-theme)))
      (load-theme theme t)
      (mcg-log "Loaded theme: %s" theme))))
#+end_src

** Theme Commands

交互式主题切换命令。

*** Switch Theme

#+begin_src emacs-lisp
;;; Theme Commands

(defun mcg/switch-theme ()
  "Interactively switch theme.
Uses completing-read to select from ef-themes."
  (interactive)
  (when (mcg--load-ef-themes)
    (let* ((themes (custom-available-themes))
           (ef-themes (seq-filter (lambda (t)
                                    (string-prefix-p "ef-" (symbol-name t)))
                                  themes))
           (theme (intern (completing-read "Select theme: "
                                           (mapcar #'symbol-name ef-themes)
                                           nil t))))
      (mapc #'disable-theme custom-enabled-themes)
      (load-theme theme t)
      (mcg-log "Switched to theme: %s" theme)
      (message "Theme: %s" theme))))
#+end_src

*** Toggle Dark/Light

#+begin_src emacs-lisp
(defun mcg/toggle-dark-light ()
  "Toggle between light and dark themes."
  (interactive)
  (when (mcg--load-ef-themes)
    (let* ((current (car custom-enabled-themes))
           (is-dark (and current
                         (string-match-p "dark\\|night\\|bio\\|dream"
                                         (symbol-name current))))
           (new-theme (if is-dark
                          mcg-ui-light-theme
                        mcg-ui-dark-theme)))
      (mapc #'disable-theme custom-enabled-themes)
      (load-theme new-theme t)
      (mcg-log "Toggled to theme: %s" new-theme)
      (message "Theme: %s" new-theme))))
#+end_src

*** Reload Theme

#+begin_src emacs-lisp
(defun mcg/reload-theme ()
  "Reload current theme."
  (interactive)
  (let ((current (car custom-enabled-themes)))
    (when current
      (mapc #'disable-theme custom-enabled-themes)
      (load-theme current t)
      (message "Reloaded theme: %s" current))))
#+end_src

** Initialize

模块初始化，设置主题。

#+begin_src emacs-lisp
;;; Initialize

;; Set up theme
(mcg-ui-setup-theme)
#+end_src

** Provide Feature

#+begin_src emacs-lisp
(provide 'init-theme)
;;; init-theme.el ends here
#+end_src
