* init-navigation.el
:PROPERTIES:
:HEADER-ARGS: :tangle init-navigation.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
;;; init-navigation.el --- Navigation Tools for MCG Emacs -*- lexical-binding: t; -*-

;; Filename: init-navigation.el
;; Description: Navigation tools module (Ace-window + Avy)
;; Author: mcge <mcgeq@outlook.com>
;; Copyright (C) 2024-2026, mcge, all rights reserved.
;; Create   Date: 2026-01-07
;; Version: 3.0
;; Keywords: navigation, window, jump, avy, ace-window
;; Compatibility: GNU Emacs 29.0+

;;; Commentary:
;;
;; Navigation tools module for MCG Emacs configuration, responsible for:
;; - Ace-window fast window switching
;; - Avy fast jumping
;; - Winner-mode window layout undo
;;

#+END_SRC

** Dependencies
#+BEGIN_SRC emacs-lisp
;;; Dependencies

(require 'core-lib)

#+END_SRC

** Ace-Window Configuration
#+BEGIN_SRC emacs-lisp
;;; Ace-Window Configuration

(defun mcg--setup-ace-window ()
  "Set up Ace-window for fast window switching."
  (when (mcg-require-extension "editor/ace-window" 'ace-window)
    ;; Use easier-to-press keys as window labels
    (setq aw-keys '(?a ?s ?d ?f ?g ?h ?j ?k ?l))
    
    ;; Window label position
    (setq aw-char-position 'top-left)
    
    ;; Show background
    (setq aw-background t)
    
    ;; Ignore certain buffers
    (setq aw-ignored-buffers '("*Calc Trail*" "*LV*"))
    
    ;; Always show dispatch menu for more actions
    (setq aw-dispatch-always t)
    
    ;; Scope: only current frame
    (setq aw-scope 'frame)
    
    ;; Custom dispatch alist with enhanced actions
    (setq aw-dispatch-alist
          '((?x aw-delete-window "Delete Window")
            (?m aw-swap-window "Swap Windows")
            (?M aw-move-window "Move Window")
            (?c aw-copy-window "Copy Window")
            (?j aw-switch-buffer-in-window "Select Buffer")
            (?n aw-flip-window "Flip Window")
            (?u aw-switch-buffer-other-window "Switch Buffer Other Window")
            (?e aw-execute-command-other-window "Execute Command Other Window")
            (?F aw-split-window-fair "Split Fair Window")
            (?v aw-split-window-vert "Split Vertically")
            (?b aw-split-window-horz "Split Horizontally")
            (?o delete-other-windows "Delete Other Windows")
            (?T aw-transpose-frame "Transpose Frame")
            (?? aw-show-dispatch-help)))
    
    ;; Window label style
    (custom-set-faces
     '(aw-leading-char-face
       ((t (:inherit ace-jump-face-foreground :height 2.0)))))
    
    (mcg-log "Ace-window configured")))

#+END_SRC

** Ace-Window Keybindings
#+BEGIN_SRC emacs-lisp
;;; Ace-Window Keybindings

(defun mcg--setup-ace-window-keybindings ()
  "Set up Ace-window keybindings."
  (when (featurep 'ace-window)
    ;; Main keybindings
    (global-set-key (kbd "M-O") 'ace-window)
    (global-set-key (kbd "C-x o") 'ace-window)
    
    ;; C-c w prefix
    (global-set-key (kbd "C-c w w") 'ace-window)
    (global-set-key (kbd "C-c w d") 'ace-delete-window)
    (global-set-key (kbd "C-c w s") 'ace-swap-window)
    (global-set-key (kbd "C-c w m") 'ace-swap-window)
    (global-set-key (kbd "C-c w o") 'delete-other-windows)
    (global-set-key (kbd "C-c w v") 'split-window-right)
    (global-set-key (kbd "C-c w h") 'split-window-below)
    
    ;; Quick delete window
    (global-set-key (kbd "C-x 0") 'ace-delete-window)
    
    ;; Quick swap window
    (global-set-key (kbd "C-x 4 s") 'ace-swap-window)
    
    (mcg-log "Ace-window keybindings configured")))

#+END_SRC

** Winner Mode Configuration
#+BEGIN_SRC emacs-lisp
;;; Winner Mode Configuration

(defun mcg--setup-winner-mode ()
  "Set up Winner-mode for window layout undo/redo."
  ;; winner-mode is built-in
  (winner-mode 1)
  
  ;; Custom keybindings for winner-mode
  ;; Default: C-c <left> for undo, C-c <right> for redo
  ;; Add more convenient bindings
  (global-set-key (kbd "C-c w u") 'winner-undo)
  (global-set-key (kbd "C-c w r") 'winner-redo)
  
  (mcg-log "Winner-mode enabled with layout undo/redo"))

#+END_SRC

** Avy Configuration
#+BEGIN_SRC emacs-lisp
;;; Avy Configuration

(defun mcg--setup-avy ()
  "Set up Avy for fast jumping."
  (when (mcg-require-extension "editor/avy" 'avy)
    ;; Use easier-to-press keys
    (setq avy-keys '(?a ?s ?d ?f ?g ?h ?j ?k ?l ?q ?w ?e ?r ?u ?i ?o ?p))
    
    ;; Jump style
    (setq avy-style 'at-full)
    
    ;; Dim background
    (setq avy-background t)
    
    ;; Jump across all windows
    (setq avy-all-windows t)
    (setq avy-all-windows-alt nil)
    
    ;; Timeout
    (setq avy-timeout-seconds 0.5)
    
    ;; Highlight first character
    (setq avy-highlight-first t)
    
    ;; Case insensitive
    (setq avy-case-fold-search t)
    
    (mcg-log "Avy configured")))

#+END_SRC

** Avy Keybindings
#+BEGIN_SRC emacs-lisp
;;; Avy Keybindings

(defun mcg--setup-avy-keybindings ()
  "Set up Avy keybindings."
  (when (featurep 'avy)
    ;; Jump to character
    (global-set-key (kbd "C-;") 'avy-goto-char)
    (global-set-key (kbd "C-'") 'avy-goto-char-2)
    
    ;; M-g prefix (standard Emacs goto prefix)
    (global-set-key (kbd "M-g w") 'avy-goto-word-1)
    (global-set-key (kbd "M-g g") 'avy-goto-line)
    (global-set-key (kbd "M-g c") 'avy-goto-char-timer)
    (global-set-key (kbd "M-g j") 'avy-goto-char-in-line)
    
    ;; Advanced commands
    (global-set-key (kbd "M-g y") 'avy-copy-line)
    (global-set-key (kbd "M-g m") 'avy-move-line)
    (global-set-key (kbd "M-g k") 'avy-kill-whole-line)
    (global-set-key (kbd "M-g Y") 'avy-copy-region)
    (global-set-key (kbd "M-g K") 'avy-kill-region)
    
    ;; isearch integration
    (define-key isearch-mode-map (kbd "C-;") 'avy-isearch)
    
    (mcg-log "Avy keybindings configured")))

#+END_SRC

** Avy Custom Functions
#+BEGIN_SRC emacs-lisp
;;; Avy Custom Functions

(defun mcg/avy-goto-word-or-subword ()
  "Jump to word or subword (part of camelCase)."
  (interactive)
  (if (bound-and-true-p subword-mode)
      (avy-goto-subword-1)
    (avy-goto-word-1)))

(defun mcg/avy-goto-open-paren ()
  "Jump to open parenthesis."
  (interactive)
  (avy-goto-char ?\())

(defun mcg/avy-goto-close-paren ()
  "Jump to close parenthesis."
  (interactive)
  (avy-goto-char ?\)))

(defun mcg/avy-goto-string ()
  "Jump to string start (quote)."
  (interactive)
  (avy-goto-char ?\"))

;; Bind custom functions
(with-eval-after-load 'avy
  (global-set-key (kbd "M-g (") 'mcg/avy-goto-open-paren)
  (global-set-key (kbd "M-g )") 'mcg/avy-goto-close-paren)
  (global-set-key (kbd "M-g \"") 'mcg/avy-goto-string))

#+END_SRC

** Window Management Transient Menu
#+BEGIN_SRC emacs-lisp
;;; Window Management Transient Menu

(defun mcg--setup-window-transient ()
  "Setup window management transient menu."
  (when (require 'transient nil t)
    ;; Window management transient menu
    (transient-define-prefix mcg-window-transient ()
      "Window management transient menu.
Provides quick access to window operations including:
- Window switching with ace-window
- Window splitting (vertical/horizontal)
- Window deletion and layout management
- Layout undo/redo with winner-mode"
      [["Switch"
        ("w" "Ace window" ace-window)
        ("o" "Other window" other-window)
        ("n" "Next window" other-window)
        ("p" "Previous window" (lambda () (interactive) (other-window -1)))]
       ["Split"
        ("v" "Split vertical" split-window-right)
        ("h" "Split horizontal" split-window-below)
        ("=" "Balance windows" balance-windows)]
       ["Delete"
        ("d" "Delete window" ace-delete-window)
        ("D" "Delete others" delete-other-windows)
        ("k" "Kill buffer & window" kill-buffer-and-window)]
       ["Layout"
        ("u" "Undo layout" winner-undo)
        ("r" "Redo layout" winner-redo)
        ("s" "Swap windows" ace-swap-window)
        ("m" "Move window" aw-move-window)]]
      [["Resize"
        ("{" "Shrink horizontal" shrink-window-horizontally)
        ("}" "Enlarge horizontal" enlarge-window-horizontally)
        ("^" "Enlarge vertical" enlarge-window)
        ("-" "Shrink vertical" shrink-window)]
       ["Buffer in Window"
        ("b" "Switch buffer" ace-window)
        ("j" "Buffer in window" aw-switch-buffer-in-window)
        ("B" "Buffer other window" switch-to-buffer-other-window)]
       ["Quick Actions"
        ("1" "Delete other windows" delete-other-windows)
        ("2" "Split below" split-window-below)
        ("3" "Split right" split-window-right)
        ("0" "Delete this window" delete-window)]])
    
    ;; Bind the transient menu
    (global-set-key (kbd "C-c w W") 'mcg-window-transient)
    
    (mcg-log "Window management transient menu configured")))

;; Custom window functions
(defun mcg/maximize-window ()
  "Maximize current window (delete other windows)."
  (interactive)
  (delete-other-windows))

(defun mcg/split-window-right-and-focus ()
  "Split window right and move focus to new window."
  (interactive)
  (split-window-right)
  (other-window 1))

(defun mcg/split-window-below-and-focus ()
  "Split window below and move focus to new window."
  (interactive)
  (split-window-below)
  (other-window 1))

(defun mcg/close-window-or-frame ()
  "Close current window, or frame if only one window."
  (interactive)
  (if (one-window-p)
      (delete-frame)
    (delete-window)))

#+END_SRC

** Initialize
#+BEGIN_SRC emacs-lisp
;;; Initialize

(mcg--setup-ace-window)
(mcg--setup-ace-window-keybindings)
(mcg--setup-winner-mode)
(mcg--setup-avy)
(mcg--setup-avy-keybindings)
(mcg--setup-window-transient)

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
(provide 'init-navigation)
;;; init-navigation.el ends here
#+END_SRC
