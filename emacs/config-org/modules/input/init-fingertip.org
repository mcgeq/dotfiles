* init-fingertip.el
:PROPERTIES:
:HEADER-ARGS: :tangle init-fingertip.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
;;; init-fingertip.el --- Fingertip Configuration for MCG Emacs -*- lexical-binding: t; -*-

;; Filename: init-fingertip.el
;; Description: 结构化编程模块
;; Author: mcge <mcgeq@outlook.com>
;; Copyright (C) 2024-2026, mcge, all rights reserved.
;; Create   Date: 2026-01-07
;; Version: 3.0
;; Keywords: fingertip, paredit, structural-editing
;; Compatibility: GNU Emacs 29.0+

;;; Commentary:
;;
;; MCG Emacs 配置架构的结构化编程模块，负责：
;; - fingertip 智能括号处理
;; - 结构化编辑快捷键
;;

#+END_SRC

** Dependencies
#+BEGIN_SRC emacs-lisp
;;; Dependencies

(require 'core-lib)

#+END_SRC

** Variables
#+BEGIN_SRC emacs-lisp
;;; Variables

(defvar mcg-fingertip-modes
  '(bash-ts-mode-hook
    c++-mode-hook c++-ts-mode-hook
    c-mode-common-hook c-mode-hook c-ts-mode-hook
    cmake-ts-mode-hook
    coffee-mode-hook
    conf-toml-mode-hook
    css-mode-hook css-ts-mode-hook
    emacs-lisp-mode-hook
    go-mode-hook
    haskell-mode-hook
    ielm-mode-hook
    jade-mode-hook
    java-mode-hook
    js-mode-hook js-ts-mode-hook
    json-ts-mode-hook
    kotlin-mode-hook
    lisp-interaction-mode-hook lisp-mode-hook
    llvm-mode-hook
    lua-mode-hook
    makefile-gmake-mode-hook
    markdown-ts-mode-hook
    maxima-mode-hook
    mojo-mode-hook
    nim-mode-hook
    php-mode-hook php-ts-mode-hook
    python-mode-hook python-ts-mode-hook
    qmake-mode-hook qml-mode-hook
    ruby-mode-hook
    rust-mode-hook rust-ts-mode-hook
    sh-mode-hook
    swift-mode-hook
    toml-ts-mode-hook
    typescript-mode-hook typescript-ts-mode-hook
    web-mode-hook
    zig-mode-hook
    fsharp-mode-hook
    clojure-mode-hook clojure-ts-mode-hook
    cider-repl-mode-hook)
  "启用 fingertip 的模式列表。")

#+END_SRC

** Configuration
#+BEGIN_SRC emacs-lisp
;;; Configuration

(defun mcg--setup-fingertip ()
  "设置 fingertip 结构化编程。"
  (when (mcg-require-extension "input/fingertip" 'fingertip)
    ;; 为各模式启用 fingertip
    (dolist (hook mcg-fingertip-modes)
      (add-hook hook
                (lambda ()
                  (when (or (not (buffer-file-name))
                            (not (string-equal (file-name-extension (buffer-file-name)) "chat")))
                    (fingertip-mode 1)))))
    
    (mcg-log "Configured fingertip")))

#+END_SRC

** Keybindings
#+BEGIN_SRC emacs-lisp
;;; Keybindings

(defun mcg--setup-fingertip-keys ()
  "设置 fingertip 快捷键。"
  (with-eval-after-load 'fingertip
    ;; 卸载默认按键
    (dolist (key '("M-J" "M-r" "M-s" "M-;" "C-M-f" "C-M-b" "M-)"))
      (define-key fingertip-mode-map (kbd key) nil))
    
    ;; 移动
    (define-key fingertip-mode-map (kbd "M-n") 'fingertip-jump-left)
    (define-key fingertip-mode-map (kbd "M-p") 'fingertip-jump-right)
    
    ;; 符号插入
    (define-key fingertip-mode-map (kbd "%") 'fingertip-match-paren)
    (define-key fingertip-mode-map (kbd "(") 'fingertip-open-round)
    (define-key fingertip-mode-map (kbd "[") 'fingertip-open-bracket)
    (define-key fingertip-mode-map (kbd "{") 'fingertip-open-curly)
    (define-key fingertip-mode-map (kbd ")") 'fingertip-close-round)
    (define-key fingertip-mode-map (kbd "]") 'fingertip-close-bracket)
    (define-key fingertip-mode-map (kbd "}") 'fingertip-close-curly)
    
    ;; 中文括号
    (define-key fingertip-mode-map (kbd "（") 'fingertip-open-chinese-round)
    (define-key fingertip-mode-map (kbd "「") 'fingertip-open-chinese-bracket)
    (define-key fingertip-mode-map (kbd "【") 'fingertip-open-chinese-curly)
    (define-key fingertip-mode-map (kbd "）") 'fingertip-close-chinese-round)
    (define-key fingertip-mode-map (kbd "」") 'fingertip-close-chinese-bracket)
    (define-key fingertip-mode-map (kbd "】") 'fingertip-close-chinese-curly)
    
    ;; 引号和其他
    (define-key fingertip-mode-map (kbd "\"") 'fingertip-double-quote)
    (define-key fingertip-mode-map (kbd "'") 'fingertip-single-quote)
    (define-key fingertip-mode-map (kbd "=") 'fingertip-equal)
    (define-key fingertip-mode-map (kbd "SPC") 'fingertip-space)
    (define-key fingertip-mode-map (kbd "RET") 'fingertip-newline)
    
    ;; 删除
    (define-key fingertip-mode-map (kbd "M-o") 'fingertip-backward-delete)
    (define-key fingertip-mode-map (kbd "C-d") 'fingertip-forward-delete)
    (define-key fingertip-mode-map (kbd "C-k") 'fingertip-kill)
    
    ;; 包围
    (define-key fingertip-mode-map (kbd "M-\"") 'fingertip-wrap-double-quote)
    (define-key fingertip-mode-map (kbd "M-'") 'fingertip-wrap-single-quote)
    (define-key fingertip-mode-map (kbd "M-{") 'fingertip-wrap-curly)
    (define-key fingertip-mode-map (kbd "M-(") 'fingertip-wrap-round)
    (define-key fingertip-mode-map (kbd "M-)") 'fingertip-unwrap)
    
    ;; 跳出并换行
    (define-key fingertip-mode-map (kbd "M-:") 'fingertip-jump-out-pair-and-newline)
    
    ;; 向父节点跳动
    (define-key fingertip-mode-map (kbd "C-j") 'fingertip-jump-up)
    
    (mcg-log "Configured fingertip keybindings")))

#+END_SRC

** Initialize
#+BEGIN_SRC emacs-lisp
;;; Initialize

(mcg--setup-fingertip)
(mcg--setup-fingertip-keys)

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
(provide 'init-fingertip)
;;; init-fingertip.el ends here
#+END_SRC
