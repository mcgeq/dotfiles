#+TITLE: Which-Key Module
#+AUTHOR: mcge
#+PROPERTY: header-args:emacs-lisp :tangle init-which-key.el :lexical t

* Which-Key Module

æœ¬æ¨¡å—è´Ÿè´£ MCG Emacs çš„æŒ‰é”®æç¤ºåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- åœ¨å¼¹å‡ºçª—å£ä¸­æ˜¾ç¤ºæŒ‰é”®ç»‘å®šæç¤º
- è‡ªå®šä¹‰æŒ‰é”®æè¿°å’Œå‰ç¼€

** File Header

#+begin_src emacs-lisp
;;; init-which-key.el --- Which-Key Configuration for MCG Emacs -*- lexical-binding: t; -*-

;; Filename: init-which-key.el
;; Description: Which-key keybinding hints module
;; Author: mcge <mcgeq@outlook.com>
;; Copyright (C) 2024-2026, mcge, all rights reserved.
;; Create   Date: 2026-01-10
;; Version: 3.0
;; Keywords: which-key, keybindings, hints
;; Compatibility: GNU Emacs 29.0+

;;; Commentary:
;;
;; Which-key module for MCG Emacs, responsible for:
;; - Displaying keybinding hints in a popup
;; - Customizing key descriptions and prefixes
;;
;; Module metadata:
;; :depends ()
;; :defer nil
;;
#+end_src

** Require

#+begin_src emacs-lisp
;;; Code:

(require 'core-lib)
#+end_src

** Which-Key Configuration

Which-key é…ç½®å‡½æ•°ï¼Œè®¾ç½®æŒ‰é”®æç¤ºçš„æ˜¾ç¤ºæ–¹å¼å’Œå¤–è§‚ã€‚

#+begin_src emacs-lisp
;;; ============================================================
;;; Which-Key Configuration
;;; ============================================================

(defun mcg--setup-which-key ()
  "Setup Which-key keybinding hints.
which-key is built-in for Emacs 30+."
  (require 'which-key)
  
  ;; Basic settings
  (setq which-key-idle-delay 0.3)
  (setq which-key-idle-secondary-delay 0.05)
  (setq which-key-popup-type 'side-window)
  (setq which-key-side-window-location 'bottom)
  (setq which-key-side-window-max-height 0.3)
  (setq which-key-min-display-lines 6)
   
  ;; Sorting and appearance
  (setq which-key-sort-order 'which-key-key-order-alpha)
  (setq which-key-separator "  ")
  (setq which-key-max-description-length 32)
  (setq which-key-add-column-padding 2)
  (setq which-key-ellipsis "..")
  
  ;; Key name beautification
  (setq which-key-special-keys '("SPC" "TAB" "RET" "DEL" "ESC"))
  (setq which-key-key-replacement-alist
        '(("<left>"  . "â†")
          ("<right>" . "â†’")
          ("<up>"    . "â†‘")
          ("<down>"  . "â†“")
          ("<return>" . "â")
          ("<tab>"   . "â‡¥")
          ("<escape>" . "â‹")
          ("SPC"     . "â£")
          ("RET"     . "â")
          ("TAB"     . "â‡¥")
          ("DEL"     . "âŒ«")))
  
  ;; Prefix descriptions
  (which-key-add-key-based-replacements
    ;; C-c prefix groups
    "C-c"     "âš™ User"
    "C-c f"   "ğŸ“ File"
    "C-c g"   " Git"
    "C-c g b" " Branch"
    "C-c g m" " Submodule"
    "C-c m"   "âœ Markmacro"
    "C-c n"   "ğŸ“ Notes/Org"
    "C-c r"   "ğŸ”§ Refactor"
    "C-c s"   "ğŸ” Search"
    "C-c t"   "ğŸ“‘ Tabs"
    "C-c u"   "â†© Undo"
    "C-c y"   "âœ‚ Snippet"
    "C-c E"   "âš™ Config"
    
    ;; C-x prefix groups
    "C-x"     "ğŸ“‹ Emacs"
    "C-x r"   "ğŸ“Œ Register/Rect"
    "C-x n"   "ğŸ“ Narrow"
    "C-x p"   "ğŸ“‚ Project"
    "C-x t"   "ğŸ—‚ Tab-bar"
    "C-x 4"   "ğŸªŸ Other Window"
    "C-x 5"   "ğŸ–¼ Frame"
    
    ;; Help
    "C-h"     "â“ Help"
    
    ;; Goto
    "M-g"     "â¡ Goto"
    
    ;; Search
    "M-s"     "ğŸ” Search")
  
  ;; Performance optimization
  (setq which-key-compute-remaps nil)
  (setq which-key-allow-evil-operators nil)
  (setq which-key-show-remaining-keys nil)
  
  ;; Fix which-key window not closing after C-g cancel
  (advice-add 'keyboard-quit :before
              (lambda (&rest _)
                (when (which-key--popup-showing-p)
                  (which-key--hide-popup))))
  
  ;; Enable
  (which-key-mode 1)
  
  (mcg-log "Which-key configured"))
#+end_src

** Initialize

åˆå§‹åŒ– Which-key åŠŸèƒ½ã€‚

#+begin_src emacs-lisp
;;; ============================================================
;;; Initialize
;;; ============================================================

(mcg--setup-which-key)
#+end_src

** Provide Feature

#+begin_src emacs-lisp
(provide 'init-which-key)
;;; init-which-key.el ends here
#+end_src
