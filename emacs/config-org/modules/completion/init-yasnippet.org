* init-yasnippet.el
:PROPERTIES:
:HEADER-ARGS: :tangle init-yasnippet.el :lexical t
:END:

** Headers
#+BEGIN_SRC emacs-lisp
;;; init-yasnippet.el --- Snippet System for MCG Emacs -*- lexical-binding: t; -*-

;; Filename: init-yasnippet.el
;; Description: 代码片段系统模块
;; Author: mcge <mcgeq@outlook.com>
;; Copyright (C) 2024-2026, mcge, all rights reserved.
;; Create   Date: 2026-01-07
;; Version: 3.0
;; Keywords: snippets, yasnippet
;; Compatibility: GNU Emacs 29.0+

;;; Commentary:
;;
;; MCG Emacs 配置架构的代码片段模块，负责：
;; - YASnippet 配置
;; - 自定义片段目录
;; - Git 用户信息集成
;;

#+END_SRC

** Dependencies
#+BEGIN_SRC emacs-lisp
;;; Dependencies

(require 'core-lib)

#+END_SRC

** Variables
#+BEGIN_SRC emacs-lisp
;;; Variables

(defvar mcg-snippet-dirs nil
  "自定义代码片段目录列表。")

#+END_SRC

** Git User Functions
#+BEGIN_SRC emacs-lisp
;;; Git User Functions

(defun mcg/get-git-user-name ()
  "获取 Git 配置的用户名。"
  (interactive)
  (replace-regexp-in-string
   "\n$" ""
   (shell-command-to-string "git config --get user.name")))

(defun mcg/get-git-user-email ()
  "获取 Git 配置的邮箱。"
  (interactive)
  (replace-regexp-in-string
   "\n$" ""
   (shell-command-to-string "git config --get user.email")))

#+END_SRC

** YASnippet Configuration
#+BEGIN_SRC emacs-lisp
;;; YASnippet Configuration

(defun mcg--setup-yasnippet ()
  "设置 YASnippet 代码片段系统。"
  (when (mcg-require-extension "completion/yasnippet" 'yasnippet)
    ;; 设置自定义片段目录
    (let ((custom-dirs
           (list (expand-file-name "site-lisp/snippets" mcg-emacs-dir)
                 (expand-file-name "site-lisp/extensions/snippets/yasnippet-snippet/snippets"
                                   mcg-emacs-dir))))
      (dolist (dir custom-dirs)
        (when (file-directory-p dir)
          (add-to-list 'yas-snippet-dirs dir))))
    
    ;; 重新加载片段
    (yas-reload-all)
    
    ;; 全局启用
    (yas-global-mode 1)
    
    ;; 在某些模式下禁用
    (dolist (hook '(term-mode-hook eshell-mode-hook))
      (add-hook hook (lambda () (yas-minor-mode -1))))
    
    (mcg-log "YASnippet configured")))

#+END_SRC

** Initialize
#+BEGIN_SRC emacs-lisp
;;; Initialize

(mcg--setup-yasnippet)

#+END_SRC

** Provide
#+BEGIN_SRC emacs-lisp
(provide 'init-yasnippet)
;;; init-yasnippet.el ends here
#+END_SRC
