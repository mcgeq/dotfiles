#+title: Emacs é…ç½®
#+author: mcge
#+email: mcgeq@outlook.com
#+date: 2025-02-16
#+language: zh-CN

[[file:README.org][English Documentation]]

* æ¬¢è¿ä½¿ç”¨æˆ‘çš„ Emacs é…ç½®

è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–ã€æ¨¡å—åŒ–çš„ Emacs é…ç½®ï¼Œä½¿ç”¨ Org Mode æ–‡å­¦ç¼–ç¨‹ç¼–å†™ã€‚
ä¸“ä¸º Emacs 29+ è®¾è®¡ï¼Œæä¾›ä¸°å¯Œçš„è¯­è¨€æ”¯æŒã€LSP é›†æˆå’Œç”Ÿäº§åŠ›åŠŸèƒ½ã€‚

* è®¾è®¡ç†å¿µ

** å†…ç½®ä¼˜å…ˆ
   å°½å¯èƒ½ä½¿ç”¨ Emacs å†…ç½®åŠŸèƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„æ’ä»¶

** æ¨¡å—åŒ–è®¾è®¡
   é…ç½®æŒ‰åŠŸèƒ½æ‹†åˆ†ä¸ºé€»è¾‘æ¨¡å—

** æ–‡å­¦ç¼–ç¨‹
   ä½¿ç”¨ Org Mode ç¼–å†™ï¼Œä¾¿äºæ–‡æ¡£åŒ–å’Œç»´æŠ¤

** æ€§èƒ½ä¼˜åŒ–
   å»¶è¿ŸåŠ è½½ã€å¿«é€Ÿå¯åŠ¨ã€æœ€å°å¼€é”€

* ğŸ¯ åŠŸèƒ½ç‰¹æ€§

** æ ¸å¿ƒæŠ€æœ¯æ ˆ
   - Emacs 29+ æ”¯æŒ tree-sitter
   - LSP Bridge è¯­è¨€æœåŠ¡å™¨é›†æˆ
   - Vertico + Marginalia + Embark è¡¥å…¨ç³»ç»Ÿ
   - Magit Git æ“ä½œ

** è¯­è¨€æ”¯æŒ
   å®Œæ•´çš„å¼€å‘æ”¯æŒï¼š
   - *ç³»ç»Ÿç¼–ç¨‹*: C/C++, Rust (rust-analyzer), Lua
   - *Web å¼€å‘*: TypeScript, JavaScript, HTML/CSS, JSX/React
   - *åŠ¨æ€è¯­è¨€*: Python, Bash
   - *æ ‡è®°è¯­è¨€*: Markdown, Org Mode

** ä¸»è¦åŠŸèƒ½
   - [[https://github.com/minad/vertico][Vertico]]: ç°ä»£åŒ–è¡¥å…¨
   - [[https://github.com/minad/marginalia][Marginalia]]: ä¸°å¯Œæ³¨è§£
   - [[https://github.com/oantolin/embark][Embark]]: ä¸Šä¸‹æ–‡æ“ä½œ
   - [[https://github.com/manateelazycat/lsp-bridge][LSP Bridge]]: æé€Ÿ LSP
   - [[https://magit.vc/][Magit]]: Git ç•Œé¢
   - [[https://github.com/manateelazycat/blink-search][Blink-search]]: é€šç”¨æœç´¢
   - [[https://github.com/manateelazycat/color-rg][Color-rg]]: å¿«é€Ÿ grep
   - [[https://github.com/manateelazycat/awesome-tray][Awesome-tray]]: è½»é‡çŠ¶æ€æ 
   - [[https://github.com/manateelazycat/emacs-rime][Rime]]: ä¸­æ–‡è¾“å…¥
   - [[https://github.com/justbur/emacs-which-key][Which-key]]: å¿«æ·é”®æç¤º â­
   - [[https://github.com/abo-abo/ace-window][Ace-window]]: å¿«é€Ÿçª—å£åˆ‡æ¢ â­
   - [[https://github.com/abo-abo/avy][Avy]]: å¿«é€Ÿè·³è½¬å¯¼èˆª â­

* ğŸ“¦ å®‰è£…

** å‰ç½®è¦æ±‚
   - Emacs 29+ï¼ˆæ¨èï¼‰æˆ– Emacs 28+ é…åˆ tree-sitter
   - Git ç”¨äºåŒ…ç®¡ç†
   - Node.js ç”¨äº lsp-bridge
   - ï¼ˆå¯é€‰ï¼‰Universal Ctags ç”¨äºç¬¦å·å¯¼èˆª

** å¿«é€Ÿå®‰è£…

*** æ­¥éª¤ 1: å…‹éš†ä»“åº“
    #+begin_src bash
    git clone <repository-url> ~/dotfiles
    cd ~/dotfiles/emacs
    #+end_src

*** æ­¥éª¤ 2: åˆå§‹åŒ– Git å­æ¨¡å—
    #+begin_src bash
    make init
    #+end_src

*** æ­¥éª¤ 3: åˆ›å»ºç”¨æˆ·é…ç½®
    #+begin_src bash
    cp custom-example.el custom.el
    #+end_src

*** æ­¥éª¤ 4: ç”Ÿæˆé…ç½®
    #+begin_src bash
    make generate
    #+end_src

*** æ­¥éª¤ 5: é“¾æ¥åˆ° Emacs

**** æ–¹å¼ A: ç¬¦å·é“¾æ¥ï¼ˆæ¨èï¼‰
     #+begin_src bash
     # Linux/macOS
     ln -s ~/dotfiles/emacs ~/.emacs.d
     
     # Windows (ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell)
     New-Item -ItemType SymbolicLink -Path $env:USERPROFILE\.emacs.d -Target D:\config\dotfiles\emacs
     #+end_src

**** æ–¹å¼ B: æ‰‹åŠ¨åŠ è½½
     #+begin_src emacs-lisp
     (load-file "~/dotfiles/emacs/site-lisp/config/init.el")
     #+end_src

*** æ­¥éª¤ 6: é¦–æ¬¡å¯åŠ¨
    #+begin_src bash
    emacs
    #+end_src

** æ•…éšœæ’é™¤
   #+begin_src bash
   make st        # æ£€æŸ¥åŒ…çŠ¶æ€
   make clean     # æ¸…ç†ç”Ÿæˆæ–‡ä»¶
   make generate  # é‡æ–°ç”Ÿæˆé…ç½®
   make h         # æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
   #+end_src

* ğŸ—‚ï¸ é…ç½®ç»“æ„

è¯¦ç»†çš„ç›®å½•ç»“æ„å’Œæ¨¡å—ç³»ç»Ÿè¯´æ˜è¯·å‚é˜… [[file:config-org/README_CN.org][config-org/README_CN.org]]ã€‚

** æ¦‚è§ˆ

#+begin_src text
emacs/
â”œâ”€â”€ Makefile                     # æ„å»ºç³»ç»Ÿ
â”œâ”€â”€ README.org                   # è‹±æ–‡æ–‡æ¡£
â”œâ”€â”€ README_CN.org                # æœ¬æ–‡ä»¶ï¼ˆä¸­æ–‡ï¼‰
â”œâ”€â”€ config-org/                  # æºç ï¼šOrg Mode æ–‡å­¦é…ç½®
â”‚   â”œâ”€â”€ README.org               # è¯¦ç»†æ¨¡å—æ–‡æ¡£
â”‚   â”œâ”€â”€ init.org                 # ä¸»å…¥å£
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒé…ç½®ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ modules/                 # åŠŸèƒ½æ¨¡å—ï¼ˆ8 ç±»åˆ«ï¼Œ35 æ¨¡å—ï¼‰
â”‚   â””â”€â”€ private/                 # ç§æœ‰é…ç½®
â”œâ”€â”€ site-lisp/                   # ç”Ÿæˆï¼šç¼–è¯‘åçš„ EL æ–‡ä»¶
â”‚   â”œâ”€â”€ config/                  # ä¸ config-org/ ç»“æ„ç›¸åŒ
â”‚   â””â”€â”€ extensions/              # Git å­æ¨¡å—
â”œâ”€â”€ snippets/                    # ä»£ç ç‰‡æ®µ
â””â”€â”€ langservers/                 # è¯­è¨€æœåŠ¡å™¨é…ç½®
#+end_src

** æ¨¡å—ç±»åˆ«

| ç±»åˆ«       | æ¨¡å—æ•° | æè¿°                       |
|------------+--------+----------------------------|
| ui         |      4 | ä¸»é¢˜ã€çŠ¶æ€æ ã€å­—ä½“ã€å›¾æ ‡   |
| editor     |      8 | ç¼–è¾‘åŠŸèƒ½                   |
| completion |      2 | Verticoã€yasnippet         |
| tools      |      5 | Magitã€æœç´¢ã€Rimeã€æ ‡ç­¾é¡µ  |
| enhance    |      5 | è‡ªåŠ¨ä¿å­˜ã€which-key ç­‰     |
| org        |      5 | Org Mode ç”Ÿæ€ç³»ç»Ÿ          |
| writing    |      2 | Markdownã€vale             |
| lang       |      9 | LSP å’Œè¯­è¨€æ”¯æŒ             |

* âš™ï¸ é…ç½®ç®¡ç†

** Makefile å‘½ä»¤

| å‘½ä»¤              | æè¿°                 |
|-------------------+----------------------|
| make              | ä» Org æ–‡ä»¶ç”Ÿæˆé…ç½®  |
| make clean        | æ¸…ç†ç”Ÿæˆæ–‡ä»¶         |
| make test         | è¿è¡Œæ‰€æœ‰æµ‹è¯•         |
| make init         | åˆå§‹åŒ– Git å­æ¨¡å—    |
| make st           | æ£€æŸ¥åŒ…çŠ¶æ€           |
| make up           | å®‰å…¨æ›´æ–°åŒ…           |
| make lock-packages| é”å®šå½“å‰åŒ…ç‰ˆæœ¬       |
| make h            | æ˜¾ç¤ºå¸®åŠ©             |

** æ¨¡å—å£°æ˜

åœ¨ =init.org= ä¸­ä½¿ç”¨ =mcg!= å®å£°æ˜å¯ç”¨çš„æ¨¡å—ï¼š

#+begin_src emacs-lisp
(mcg! :ui
      theme modeline font icons
      
      :editor
      defaults treesit navigation keybindings
      paredit format undo multicursor
      
      :completion
      vertico yasnippet
      
      :tools
      magit search rime tabs eshell
      
      :enhance
      autosave which-key helpful recentf symbol
      
      :org
      org org-agenda org-babel org-capture org-extras
      
      :writing
      markdown vale
      
      :lang
      lsp lsp-common rust python typescript web cpp lua zig)
#+end_src

** è¿ç§»æŒ‡å— â­

å¦‚æœä»æ—§ç‰ˆæœ¬é…ç½®è¿ç§»ï¼š

*** ç±»åˆ«å˜æ›´

| æ—§ç±»åˆ«   | æ–°ç±»åˆ«   | è¯´æ˜                         |
|----------+----------+------------------------------|
| :input   | :editor  | è¾“å…¥æ¨¡å—åˆå¹¶åˆ°ç¼–è¾‘å™¨ç±»åˆ«     |
| :docs    | :writing | æ–‡æ¡£ç±»åˆ«é‡å‘½åä¸ºå†™ä½œç±»åˆ«     |
| (æ— )     | :enhance | æ–°å¢å¢å¼ºåŠŸèƒ½ç±»åˆ«             |

*** æ¨¡å—é‡å‘½å

| æ—§æ¨¡å—å             | æ–°æ¨¡å—å          | è¯´æ˜         |
|----------------------+-------------------+--------------|
| :input fingertip     | :editor paredit   | ç»“æ„åŒ–ç¼–è¾‘   |
| :input wraplish      | :editor format    | æ–‡æœ¬æ ¼å¼åŒ–   |
| :docs markdown       | :writing markdown | Markdown     |
| :tools sort-tab      | :tools tabs       | æ ‡ç­¾é¡µç®¡ç†   |
| :tools utils         | :enhance (æ‹†åˆ†)   | å·¥å…·æ¨¡å—æ‹†åˆ† |

*** æ–°å¢æ¨¡å—

| ç±»åˆ«     | æ¨¡å—å      | åŠŸèƒ½             |
|----------+-------------+------------------|
| :ui      | icons       | Nerd icons é…ç½®  |
| :editor  | undo        | å¯è§†åŒ–æ’¤é”€       |
| :editor  | multicursor | å¤šå…‰æ ‡ç¼–è¾‘       |
| :enhance | autosave    | ç©ºé—²è‡ªåŠ¨ä¿å­˜     |
| :enhance | which-key   | å¿«æ·é”®æç¤º       |
| :enhance | helpful     | å¢å¼ºå¸®åŠ©ç³»ç»Ÿ     |
| :enhance | recentf     | æœ€è¿‘æ–‡ä»¶         |
| :enhance | symbol      | ç¬¦å·é«˜äº®         |
| :writing | vale        | è¯­æ³•æ£€æŸ¥         |

*** è‡ªåŠ¨è¿ç§»æ”¯æŒ

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ—§çš„ç±»åˆ«/æ¨¡å—åç§°å¹¶æ˜¾ç¤ºè­¦å‘Šï¼š

#+begin_example
Warning: Category :input is deprecated, use :editor instead
Warning: Module fingertip is renamed to paredit
#+end_example

* âŒ¨ï¸ å¿«æ·é”®

æ‰€æœ‰è‡ªå®šä¹‰ç»‘å®šä½¿ç”¨ =C-c= å‰ç¼€ï¼ˆç”¨æˆ·ä¿ç•™åŒºï¼‰ï¼Œå¹¶æä¾› which-key æè¿°ã€‚

** å¿«é€Ÿå‚è€ƒ

| å‰ç¼€    | æè¿°           |
|---------+----------------|
| C-c g   | Git (Magit)    |
| C-c w   | çª—å£           |
| C-c s   | æœç´¢           |
| C-c r   | é‡æ„           |
| C-c t   | æ ‡ç­¾é¡µ         |
| C-c n   | ç¬”è®°/Org       |
| C-c m   | å¤šå…‰æ ‡         |
| M-g     | è·³è½¬ (Avy)     |

** LSP å¯¼èˆª

| å¿«æ·é”® | æè¿°         |
|--------+--------------|
| M-.    | è·³è½¬åˆ°å®šä¹‰   |
| M-,    | è¿”å›         |
| M-?    | æŸ¥æ‰¾å¼•ç”¨     |
| C-h .  | æ˜¾ç¤ºæ–‡æ¡£     |

** çª—å£æ“ä½œ

| å¿«æ·é”®  | æè¿°           |
|---------+----------------|
| M-O     | å¿«é€Ÿåˆ‡æ¢ (ace) |
| C-c w w | åˆ‡æ¢çª—å£       |
| C-c w d | åˆ é™¤çª—å£       |
| C-c w s | äº¤æ¢çª—å£       |

** æœç´¢

| å¿«æ·é”®  | æè¿°                   |
|---------+------------------------|
| C-c s l | æœç´¢è¡Œ (consult)       |
| C-c s g | æœç´¢å†…å®¹ (color-rg)    |
| C-c s B | Blink æœç´¢             |

å®Œæ•´å¿«æ·é”®å‚è€ƒï¼Œåœ¨ Emacs ä¸­æŒ‰ =C-h K=ã€‚

* ğŸ”§ è‡ªå®šä¹‰

** ç”¨æˆ·è®¾ç½®

ç¼–è¾‘ =custom.el= è¿›è¡Œä¸ªäººè®¾ç½®ï¼š

#+begin_src emacs-lisp
(setq mcg-theme 'doom-one)
(setq mcg-font-size 14)
#+end_src

** æ·»åŠ æ–°æ¨¡å—

1. åœ¨ =config-org/modules/CATEGORY/= åˆ›å»º Org æ–‡ä»¶
2. ä½¿ç”¨ =:tangle= æŒ‡ä»¤ç¼–å†™ä»£ç å—
3. åœ¨ =init.org= çš„ =mcg!= å£°æ˜ä¸­æ·»åŠ æ¨¡å—
4. è¿è¡Œ =make generate=

* ğŸ“ Org Mode

** æ¨¡å—åŒ–é…ç½®ç³»ç»Ÿ â­

æœ¬é…ç½®é‡‡ç”¨å…¨æ–°çš„æ¨¡å—åŒ– Org mode é…ç½®ç³»ç»Ÿï¼š

- *ç»Ÿä¸€å˜é‡ç®¡ç†* :: æ‰€æœ‰å˜é‡ä½¿ç”¨ =mcg-org-*= å‘½åç©ºé—´
- *æ¨¡å—åŒ–åŠ è½½* :: æŒ‰éœ€åŠ è½½ï¼Œæ™ºèƒ½ä¾èµ–ç®¡ç†
- *åŠŸèƒ½å¼€å…³* :: é€šè¿‡å˜é‡è½»æ¾å¯ç”¨/ç¦ç”¨åŠŸèƒ½
- *é”™è¯¯è¯Šæ–­* :: å†…ç½®çŠ¶æ€æŸ¥çœ‹å’ŒéªŒè¯å·¥å…·

** ä¸»è¦åŠŸèƒ½

- *Agenda* :: ä»»åŠ¡ç®¡ç†å’Œæ—¥ç¨‹å®‰æ’
- *Capture* :: å¿«é€Ÿç¬”è®°æ•è·ï¼ˆå¤šç§æ¨¡æ¿ï¼‰
- *Export* :: å¤šæ ¼å¼å¯¼å‡º (HTML, Markdown, PDF)
- *Babel* :: æ–‡æ¡£å†…ä»£ç æ‰§è¡Œï¼ˆæ”¯æŒ Zigï¼ï¼‰âœ¨
- *Hugo* :: åšå®¢å‘å¸ƒé›†æˆï¼ˆå¯é€‰ï¼‰
- *ä¸­æ–‡æ—¥å†* :: å†œå†ã€èŠ‚æ°”ã€æ—¥å‡ºæ—¥è½

** Org Babel æ”¯æŒçš„è¯­è¨€

- âœ… Emacs Lisp - Emacs é…ç½®å’Œè„šæœ¬
- âœ… Python - æ•°æ®åˆ†æã€è„šæœ¬
- âœ… Shell/Bash - ç³»ç»Ÿå‘½ä»¤
- âœ… Zig - ç³»ç»Ÿç¼–ç¨‹ ğŸ¦
- âœ… JavaScript - å‰ç«¯è„šæœ¬
- âœ… C/C++ - ç³»ç»Ÿç¼–ç¨‹
- âœ… SQL - æ•°æ®åº“æŸ¥è¯¢

** ç®¡ç†å‘½ä»¤

#+begin_src emacs-lisp
M-x mcg-org-show-status      ; æ˜¾ç¤ºé…ç½®çŠ¶æ€
M-x mcg-org-list-modules     ; åˆ—å‡ºæ‰€æœ‰æ¨¡å—
M-x mcg-org-load-module      ; åŠ è½½æŒ‡å®šæ¨¡å—
M-x mcg-org-reload-module    ; é‡æ–°åŠ è½½æ¨¡å—
#+end_src

* ğŸ” è°ƒè¯•

** å¸¸è§é”™è¯¯

*** æ‰©å±•åŠ è½½é”™è¯¯
#+begin_src bash
# åˆå§‹åŒ–æ‰€æœ‰å­æ¨¡å—
make init
#+end_src

*** å¾ªç¯ä¾èµ–
#+begin_src emacs-lisp
M-x mcg-check-circular-dependencies
#+end_src

*** è¯Šæ–­å‘½ä»¤
#+begin_src emacs-lisp
M-x mcg-validate-all              ; éªŒè¯æ‰€æœ‰é…ç½®
M-x mcg-display-categories-status ; æŸ¥çœ‹ç±»åˆ«çŠ¶æ€
M-x mcg-display-platform-info     ; æŸ¥çœ‹å¹³å°ä¿¡æ¯
#+end_src

* ğŸ“š èµ„æº

** æ–‡æ¡£
   - [[https://www.gnu.org/software/emacs/manual/][Emacs æ‰‹å†Œ]]
   - [[https://orgmode.org/manual/][Org Mode æ‰‹å†Œ]]
   - [[https://github.com/manateelazycat/lsp-bridge][lsp-bridge]]
   - [[https://magit.vc/][Magit]]

** æç¤º
   - ä½¿ç”¨ =C-h v= æŸ¥çœ‹å˜é‡
   - ä½¿ç”¨ =C-h k= æŸ¥çœ‹æŒ‰é”®åŠŸèƒ½
   - æ£€æŸ¥ =*Messages*= buffer æŸ¥çœ‹é”™è¯¯

* ğŸ“„ è®¸å¯è¯

ä¸çˆ¶ dotfiles ä»“åº“ç›¸åŒã€‚
