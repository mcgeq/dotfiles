#+title: Emacs Configuration
#+author: mcge
#+email: mcgeq@outlook.com
#+date: 2025-02-16
#+language: en

[[file:README_CN.org][‰∏≠ÊñáÊñáÊ°£]]

* Welcome to My Emacs Configuration

This is a modern, modular Emacs configuration written using literate programming
with Org Mode. It's designed for Emacs 29+ with extensive language support,
LSP integration, and productivity features.

* Philosophy

** Built-in First
   Reconfigure Emacs to use as many built-in features as possible and use fewer
   unnecessary plugins.

** Modular Design
   Configuration split into logical modules organized by functionality

** Literate Programming
   Written in Org Mode for easy documentation and maintenance

** Performance Optimized
   Lazy loading, fast startup, and minimal overhead

* üéØ Features

** Core Stack
   - Emacs 29+ with tree-sitter support
   - LSP Bridge for language server integration
   - Vertico + Marginalia + Embark for completions
   - Magit for Git operations

** Language Support
   Full development support for:
   - *Systems*: C/C++, Rust (rust-analyzer), Lua
   - *Web*: TypeScript, JavaScript, HTML/CSS, JSX/React
   - *Dynamic*: Python, Bash
   - *Markup*: Markdown, Org Mode

** Key Features
   - [[https://github.com/minad/vertico][Vertico]]: Modern minibuffer completions
   - [[https://github.com/minad/marginalia][Marginalia]]: Rich annotations
   - [[https://github.com/oantolin/embark][Embark]]: Contextual actions
   - [[https://github.com/manateelazycat/lsp-bridge][LSP Bridge]]: Blazing fast LSP
   - [[https://magit.vc/][Magit]]: Git interface
   - [[https://github.com/manateelazycat/blink-search][Blink-search]]: Universal search
   - [[https://github.com/manateelazycat/color-rg][Color-rg]]: Fast grep
   - [[https://github.com/manateelazycat/awesome-tray][Awesome-tray]]: Lightweight status display
   - [[https://github.com/manateelazycat/emacs-rime][Rime]]: Chinese input
   - [[https://github.com/justbur/emacs-which-key][Which-key]]: Keybinding hints
   - [[https://github.com/abo-abo/ace-window][Ace-window]]: Quick window switching
   - [[https://github.com/abo-abo/avy][Avy]]: Fast navigation

* üì¶ Installation

** Prerequisites
   - Emacs 29+ (recommended) or Emacs 28+ with tree-sitter
   - Git for package management
   - Node.js for lsp-bridge
   - (Optional) Universal Ctags for symbol navigation

** Quick Install

*** Step 1: Clone Repository
    #+begin_src bash
    git clone <repository-url> ~/dotfiles
    cd ~/dotfiles/emacs
    #+end_src

*** Step 2: Initialize Git Submodules
    #+begin_src bash
    make init
    #+end_src

*** Step 3: Create User Configuration
    #+begin_src bash
    cp custom-example.el custom.el
    #+end_src

*** Step 4: Generate Configuration
    #+begin_src bash
    make generate
    #+end_src

*** Step 5: Link to Emacs

**** Option A: Symlink (Recommended)
     #+begin_src bash
     # Linux/macOS
     ln -s ~/dotfiles/emacs ~/.emacs.d
     
     # Windows (PowerShell as Administrator)
     New-Item -ItemType SymbolicLink -Path $env:USERPROFILE\.emacs.d -Target D:\config\dotfiles\emacs
     #+end_src

**** Option B: Manual Load
     #+begin_src emacs-lisp
     (load-file "~/dotfiles/emacs/site-lisp/config/init.el")
     #+end_src

*** Step 6: First Launch
    #+begin_src bash
    emacs
    #+end_src

** Troubleshooting
   #+begin_src bash
   make st        # Check package status
   make clean     # Clean generated files
   make generate  # Regenerate config
   make h         # View all commands
   #+end_src

* üóÇÔ∏è Configuration Structure

For detailed directory structure and module system documentation, see [[file:config-org/README.org][config-org/README.org]].

** Overview

#+begin_src text
emacs/
‚îú‚îÄ‚îÄ Makefile                     # Build system
‚îú‚îÄ‚îÄ README.org                   # This file (English)
‚îú‚îÄ‚îÄ README_CN.org                # Chinese documentation
‚îú‚îÄ‚îÄ config-org/                  # Source: Org Mode literate config
‚îÇ   ‚îú‚îÄ‚îÄ README.org               # Detailed module documentation
‚îÇ   ‚îú‚îÄ‚îÄ init.org                 # Main entry point
‚îÇ   ‚îú‚îÄ‚îÄ core/                    # Core configuration (4 files)
‚îÇ   ‚îú‚îÄ‚îÄ modules/                 # Feature modules (8 categories, 35 modules)
‚îÇ   ‚îî‚îÄ‚îÄ private/                 # Private configuration
‚îú‚îÄ‚îÄ site-lisp/                   # Generated: Compiled EL files
‚îÇ   ‚îú‚îÄ‚îÄ config/                  # Same structure as config-org/
‚îÇ   ‚îî‚îÄ‚îÄ extensions/              # Git submodules
‚îú‚îÄ‚îÄ snippets/                    # Snippets
‚îî‚îÄ‚îÄ langservers/                 # Language server configs
#+end_src

** Module Categories

| Category   | Modules | Description                       |
|------------+---------+-----------------------------------|
| ui         |       4 | Theme, modeline, font, icons      |
| editor     |       8 | Editing features                  |
| completion |       2 | Vertico, yasnippet                |
| tools      |       5 | Magit, search, rime, tabs, eshell |
| enhance    |       5 | Autosave, which-key, helpful, etc.|
| org        |       5 | Org Mode ecosystem                |
| writing    |       2 | Markdown, vale                    |
| lang       |       9 | LSP and language support          |

* ‚öôÔ∏è Configuration Management

** Makefile Commands

| Command           | Description                    |
|-------------------+--------------------------------|
| make              | Generate config from Org files |
| make clean        | Clean generated files          |
| make test         | Run all tests                  |
| make init         | Initialize Git Submodules      |
| make st           | Check package status           |
| make up           | Update packages safely         |
| make lock-packages| Lock current package versions  |
| make h            | Show help                      |

** Module Declaration

Use =mcg!= macro in =init.org= to declare enabled modules:

#+begin_src emacs-lisp
(mcg! :ui
      theme modeline font icons
      
      :editor
      defaults treesit navigation keybindings
      paredit format undo multicursor
      
      :completion
      vertico yasnippet
      
      :tools
      magit search rime tabs eshell
      
      :enhance
      autosave which-key helpful recentf symbol
      
      :org
      org org-agenda org-babel org-capture org-extras
      
      :writing
      markdown vale
      
      :lang
      lsp lsp-common rust python typescript web cpp lua zig)
#+end_src

** Migration Guide

If migrating from an older configuration version:

*** Category Changes

| Old Category | New Category | Notes                          |
|--------------+--------------+--------------------------------|
| :input       | :editor      | Input modules merged to editor |
| :docs        | :writing     | Docs renamed to writing        |
| (none)       | :enhance     | New enhancement category       |

*** Module Renames

| Old Module          | New Module        |
|---------------------+-------------------|
| :input fingertip    | :editor paredit   |
| :input wraplish     | :editor format    |
| :docs markdown      | :writing markdown |
| :tools sort-tab     | :tools tabs       |

The system automatically detects old names and shows warnings.

* ‚å®Ô∏è Key Bindings

All custom bindings use =C-c= prefix (user reserved area) with which-key descriptions.

** Quick Reference

| Prefix  | Description      |
|---------+------------------|
| C-c g   | Git (Magit)      |
| C-c w   | Window           |
| C-c s   | Search           |
| C-c r   | Refactor         |
| C-c t   | Tabs             |
| C-c n   | Notes/Org        |
| C-c m   | Multi-cursor     |
| M-g     | Goto (Avy)       |

** LSP Navigation

| Key   | Description          |
|-------+----------------------|
| M-.   | Go to definition     |
| M-,   | Return               |
| M-?   | Find references      |
| C-h . | Show documentation   |

** Window Operations

| Key     | Description        |
|---------+--------------------|
| M-O     | Quick switch (ace) |
| C-c w w | Switch window      |
| C-c w d | Delete window      |
| C-c w s | Swap windows       |

** Search

| Key     | Description              |
|---------+--------------------------|
| C-c s l | Search line (consult)    |
| C-c s g | Search content (color-rg)|
| C-c s B | Blink search             |

For complete keybinding reference, press =C-h K= in Emacs.

* üîß Customization

** User Settings

Edit =custom.el= for personal settings:

#+begin_src emacs-lisp
(setq mcg-theme 'doom-one)
(setq mcg-font-size 14)
#+end_src

** Adding New Modules

1. Create an Org file in =config-org/modules/CATEGORY/=
2. Use =:tangle= directive for code blocks
3. Add module to =mcg!= declaration in =init.org=
4. Run =make generate=

* üìö Resources

** Documentation
   - [[https://www.gnu.org/software/emacs/manual/][Emacs Manual]]
   - [[https://orgmode.org/manual/][Org Mode Manual]]
   - [[https://github.com/manateelazycat/lsp-bridge][lsp-bridge]]
   - [[https://magit.vc/][Magit]]

** Tips
   - Use =C-h v= to view variables
   - Use =C-h k= to see what a key does
   - Check =*Messages*= buffer for errors

* üìÑ License

Same as the parent dotfiles repository.
