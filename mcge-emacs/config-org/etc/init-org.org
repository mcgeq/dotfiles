* init-org.el
:PROPERTIES:
:HEADER-ARGS: :tangle (concat temporary-file-directory "init-org.el") :lexical t
:END:

** Headers
#+begin_src emacs-lisp
;;; init-org.el --- org config  -*- lexical-binding: t; -*-

;;; Commentary:

#+end_src

** Require
#+begin_src emacs-lisp
;;; Require:
(require 'org)
(require 'init-const)
(require 'org-num)
#+end_src

** Code

*** Org num
#+begin_src emacs-lisp
;; å…¨å±€å¯ç”¨ org-numï¼Œå¯ç”¨æ—¶ä¼šè‡ªåŠ¨ä¸ºæ‰€æœ‰æ ‡é¢˜æ·»åŠ ç¼–å·
(add-hook 'org-mode-hook #'org-num-mode)

;; åŸºæœ¬è®¾ç½®
(setq org-num-skip-unnumbered nil)       ; ä¸ºæ‰€æœ‰æ ‡é¢˜ç¼–å·ï¼Œå³ä½¿æ˜¯æ²¡æœ‰ `NUM:nil` çš„æ ‡é¢˜
(setq org-num-max-level 6)               ; ä»…ä¸º6çº§ä»¥å†…çš„æ ‡é¢˜ç¼–å·
(setq org-num-format-function #'org-num-format) ; ä½¿ç”¨é»˜è®¤çš„ç¼–å·æ ¼å¼åŒ–å‡½æ•°

;; è‡ªå®šä¹‰ç¼–å·æ ¼å¼
;; è®¾ç½®è‡ªå®šä¹‰çš„ç¼–å·æ ¼å¼ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´
(setq org-num-face '(:foreground "#ff79c6" :weight bold)) ; è®¾ç½®ç¼–å·çš„å­—ä½“æ ·å¼
(setq org-num-format-function
      (lambda (numbers) 
        (concat (mapconcat #'number-to-string numbers ".") " "))) ; æ ¼å¼ä¸ºâ€œ1.1.1 â€å½¢å¼

;; è·³è¿‡ç¼–å·çš„æ ‡é¢˜
(setq org-num-skip-tags '("no-num" "skip"))  ; æ ‡æœ‰è¿™äº›æ ‡ç­¾çš„æ ‡é¢˜ä¸ä¼šè¢«ç¼–å·

;; é’ˆå¯¹ç‰¹å®šæ ‡é¢˜è¿›è¡Œç¼–å·æ§åˆ¶
(defun mcge/org-num-custom ()
  "ä¸º Org-mode è‡ªå®šä¹‰ç¼–å·æ ¼å¼."
  ;; ä¸ºå½“å‰ buffer çš„æ‰€æœ‰æ ‡é¢˜æ·»åŠ ç¼–å·
  (org-num-mode 1)
  ;; å¯ä»¥è¿›ä¸€æ­¥æ·»åŠ ä¸ªæ€§åŒ–è®¾ç½®
  )

;; æ·»åŠ åˆ° org-mode çš„é’©å­ä¸­
(add-hook 'org-mode-hook 'mcge/org-num-custom)
#+end_src

*** Org Mode
#+begin_src emacs-lisp
;;; Code:

(setq org-directory mcgemacs-org-dir)
(setq org-default-notes-file (expand-file-name "capture.org" org-directory))

;; æ ‡é¢˜ç¼©è¿›
;;(setq org-startup-indented t)

;; å½“çŠ¶æ€ä» DONE æ”¹æˆå…¶ä»–çŠ¶æ€æ—¶ï¼Œç§»é™¤ CLOSED: [timestamp]
(setq org-closed-keep-when-no-todo t)
;; DONE æ—¶åŠ ä¸Šæ—¶é—´æˆ³
(setq org-log-done 'time)
;; é‡å¤æ‰§è¡Œæ—¶åŠ ä¸Šæ—¶é—´æˆ³
(setq org-log-repeat 'time)
;; Deadline ä¿®æ”¹æ—¶åŠ ä¸Šä¸€æ¡è®°å½•
(setq org-log-redeadline 'note)
;; Schedule ä¿®æ”¹æ—¶åŠ ä¸Šä¸€æ¡è®°å½•
(setq org-log-reschedule 'note)
;; ä»¥æŠ½å±‰çš„æ–¹å¼è®°å½•
(setq org-log-into-drawer t)
;; ç´§æ¥ç€æ ‡é¢˜è¡Œæˆ–è€…è®¡åˆ’/æˆªæ­¢æ—¶é—´æˆ³ååŠ ä¸Šè®°å½•æŠ½å±‰
(setq org-log-state-notes-insert-after-drawers nil)

;; è‡ªåŠ¨å¯¹é½æ ‡ç­¾
(setq org-auto-align-tags t)
;; æ ‡ç­¾ä¸ç»§æ‰¿
(setq org-use-tag-inheritance nil)
;; æ ‡ç­¾å¿«é€Ÿé€‰æ‹©
(setq org-use-fast-tag-selection t)
;; æ ‡ç­¾é€‰æ‹©ä¸éœ€è¦å›è½¦ç¡®è®¤
(setq org-fast-tag-selection-single-key t)
;; å®šä¹‰äº†æœ‰åºå±æ€§çš„æ ‡é¢˜è¡Œä¹ŸåŠ ä¸Š OREDERD æ ‡ç­¾
(setq org-track-ordered-property-with-tag t)
;; å§‹ç»ˆå­˜åœ¨çš„çš„æ ‡ç­¾
(setq org-tag-persistent-alist '(("@outdoors" . ?o)
                                 ("INBOX" . ?i)))

;; Block
;; å¦‚ä½•åœ¨ Source Block ä¸­åƒåœ¨è¯­è¨€ mode ä¸­ä¸€æ ·çš„ç¼©è¿›
(setq org-src-tab-acts-natively t)
;; æ§åˆ¶åŸå§‹ç¼©è¿›
(setq org-src-preserve-indentation t)
;; Set the major mode for editing source code
(setq org-edit-src-content-indentation 0)
;; code block é»˜è®¤æŠ˜å å±•ç¤º
(setq org-hide-block-startup t)

;; å¦‚ä½•ç¾åŒ– quote å’Œ verse block
(setq org-fontify-quote-and-verse-blocks t)

;; æ›´æ”¹å­ list çš„æ˜¾ç¤ºç¬¦å·
(setq org-list-demote-modify-bullet
      '(("+" . "-") ("-" . "+") ("*" . "+") ("1." . "a.")))

;; éšè—å¼ºè°ƒæ ‡è®°
(setq org-hide-emphasis-markers t)

;; é¢å¤–çš„è¡Œé—´è·ï¼Œ0.1 è¡¨ç¤º 10%ï¼Œ1è¡¨ç¤º 1px
(setq-default line-spacing 0.1)

;; ä½¿ç”¨"â¤µ" æŒ‡ç¤ºéšè—å†…å®¹
(setq org-ellipsis "â¤µ")

(add-hook 'org-mode-hook 'my/org-prettify-symbols)

;; ================================
;; åœ¨ org mode é‡Œç¾åŒ–å­—ç¬¦ä¸²
;; ================================
(defun my/org-prettify-symbols ()
  (setq prettify-symbols-alist
        (mapcan (lambda (x) (list x (cons (upcase (car x)) (cdr x))))
				  '(
					;; ("[ ]"              . 9744)         ; â˜
					;; ("[X]"              . 9745)         ; â˜‘
					;; ("[-]"              . 8863)         ; âŠŸ
					("#+begin_src"      . 9998)         ; âœ
					("#+end_src"        . "â™ ")            ; 9763
					("#+begin_example"  . 129175)       ; ğŸ¢—
					("#+end_example"    . 129173)       ; ğŸ¢•
					("#+results:"       . 9776)         ; â˜°
					("#+attr_latex:"    . "ğŸ„")
					("#+attr_html:"     . "ğŸ„—")
					("#+attr_org:"      . "ğŸ””")
					("#+name:"          . "(N)")         ; 127261
					("#+caption:"       . "(c)")         ; 127250
					("#+date:"          . "âš“")         ; 128197
					("#+author:"        . "ğŸ‘¨")         ; 
					("#+setupfile:"     . 128221)       ; ğŸ“
					("#+email:"         . 128231)       ; ğŸ“§
					("#+startup:"       . 10034)        ; âœ²
					("#+options:"       . "âŒ¥")         ; â›­ 9965
					("#+title:"         . 10162)        ; â²
					("#+subtitle:"      . 11146)        ; â®Š
					("#+downloaded:"    . 8650)         ; â‡Š
					("#+language:"      . 128441)       ; ğŸ–¹
					("#+begin_quote"    . 187)          ; Â»
					("#+end_quote"      . 171)          ; Â«
                                        ("#+begin_results"  . 8943)         ; â‹¯
                                        ("#+end_results"    . 8943)         ; â‹¯
                                        ("#+property:"      . "â˜¸")
                                        (":PROPERTIES:"     . "âš™")
					)))
    (setq prettify-symbols-unprettify-at-point t)
    (prettify-symbols-mode 1))


;; TODO Keyword
(setq org-todo-keywords '((sequence "TODO(t!)" "HOLD(h!)" "WIP(i!)" "WAIT(w@/!)" "|" "DONE(d@!)" "CANCELLED(c@/!)")
                          (sequencen "REPORT(r)" "BUG(b)" "KNOWNCAUSE(k)" "|" "FIXED(f!)")))
(setq org-todo-keyword-faces '(("TODO"       :foreground "#7c7c75" :weight bold)
			       ("HOLD"       :foreground "#feb24c" :weight bold)
			       ("WIP"        :foreground "#0098dd" :weight bold)
			       ("WAIT"       :foreground "#9f7efe" :weight bold)
			       ("DONE"       :foreground "#50a14f" :weight bold)
			       ("CANCELLED"  :foreground "#ff6480" :weight bold)
			       ("REPORT"     :foreground "magenta" :weight bold)
			       ("BUG"        :foreground "red"     :weight bold)
			       ("KNOWNCAUSE" :foreground "yellow"  :weight bold)
			       ("FIXED"      :foreground "green"   :weight bold)))

(setq org-todo-state-tags-triggers
      (quote (("CANCELLED" ("CANCELLED" . t))
	      ("WAIT" ("WAIT" . t))
	      ("HOLD" ("WAIT") ("HOLD" . t))
	      (done ("WAIT") ("HOLD"))
	      ("TODO" ("WAIT") ("CANCELLED") ("HOLD"))
	      ("DONE" ("WAIT") ("CANCELLED") ("HOLD")))))
;; ä¼˜å…ˆçº§æ ·å¼è®¾ç½®
(setq org-priority-faces '((?A :foreground "red")
			   (?B :foreground "orange")
			   (?C :foreground "yellow")))
;; æ ‡é¢˜è¡Œå…¨å±€å±æ€§è®¾ç½®
(setq org-global-properties '(("EFFORT_ALL" . "0:15 0:30 0:45 1:00 2:00 3:00 4:00 5:00 6:00 7:00 8:00")
			 ("APPT_WARNTIME_ALL" . "0 5 10 15 20 25 30 45 60")
			 ("RISK_ALL" . "Low Medium High")
			 ("STYLE_ALL" . "habit")))

;; é¢„å®šä¹‰å¥½çš„æ ‡ç­¾
(setq org-tag-alist '((:startgrouptag)
		      ("Mcg"             . ?M)
                      (:grouptags        . nil)
		      ("@Read"           . ?R)
                      ("@Work"           . ?W)
                      ("@Home"           . ?h)
                      ("@Software"       . ?S)
                      ("@Hardware"       . ?H)
                      (:endgrouptag)
                      (:startgrouptag)
                      ("@Read"           . ?R)
                      (:grouptags)
                      ("read_book"       . ?r)
                      ("read_ebook"      . ?e)
                      ("news"            . ?n)
                      (:endgrouptag)
                      (:startgrouptag)
                      ("@Work"           . ?W)
                      (:grouptags)
                      ("meeting"         . ?m)
                      ("testing"         . ?t)
                      (:endgrouptag)
                      (:startgrouptag)
                      ("@Software"       . ?S)
                      (:grouptags)
                      ("vscode"          . ?v)
                      ("emacs"           . ?e)
                      ("IDEA"            . ?I)
                      (:endgrouptag)
                      (:startgrouptag)
                      ("@Hardware"       . ?H)
                      (:grouptags)
                      ("computer"        . ?c)
                      ("phone"           . ?p)
                      (:endgrouptag)))
#+end_src

*** Custom face

#+begin_src emacs-lisp
;; custom face
;; è®¾ç½® org æ ‡é¢˜ 1-8 çº§çš„å­—ä½“å¤§å°å’Œé¢œè‰²ï¼Œé¢œè‰²æ‘˜æŠ„è‡ª monokaiã€‚;å¸Œæœ› org-mode æ ‡é¢˜çš„å­—ä½“å¤§å°å’Œæ­£æ–‡ä¸€è‡´ï¼Œè®¾æˆ 1.0ï¼Œ å¦‚æœå¸Œæœ›æ ‡é¢˜å­—ä½“å¤§ä¸€ç‚¹å¯ä»¥è®¾æˆ 1.2
(custom-set-faces
  '(org-document-title ((t (:height 1.75 :weight bold ))))
  '(org-level-1 ((t (:inherit outline-1 :height 1.2  :foreground "#FD971F"))))
  '(org-level-2 ((t (:inherit outline-2 :height 1.15  :foreground "#002EFF"))))
  '(org-level-3 ((t (:inherit outline-3 :height 1.1  :foreground "#004EFF"))))
  '(org-level-4 ((t (:inherit outline-4 :height 1.05  :foreground "#008EFF"))))
  '(org-level-5 ((t (:inherit outline-5 :height 1.0  :foreground "#00AEFF"))))
  '(org-level-6 ((t (:inherit outline-6 :height 1.0  :foreground "#00EEFF"))))
  '(org-level-7 ((t (:inherit outline-7 :height 1.0  :foreground "#66EEFF"))))
  '(org-level-8 ((t (:inherit outline-8 :height 1.0  :foreground "#66D9EF"))))
 )

(custom-set-faces
   '(region ((t (:foreground "green" :background "#464646")))))

;; è§£å†³æ ‡è®°ç¬¦å·å‰åç©ºæ ¼é—®é¢˜
(setq org-emphasis-regexp-components '("-[:space:]('\"{[:nonascii:]"
                                         "-[:space:].,:!?;'\")}\\[[:nonascii:]"
                                         "[:space:]"
                                         "."
                                         1))

(setq org-match-substring-regexp
        (concat
         ;; é™åˆ¶ä¸Šæ ‡å’Œä¸‹æ ‡çš„åŒ¹é…èŒƒå›´ï¼Œorg ä¸­å¯¹å…¶çš„ä»‹ç»è§ï¼š(org) Subscripts and superscripts
         "\\([0-9a-zA-ZÎ±-Î³Î‘-Î©]\\)\\([_^]\\)\\("
         "\\(?:" (org-create-multibrace-regexp "{" "}" org-match-sexp-depth) "\\)"
         "\\|"
         "\\(?:" (org-create-multibrace-regexp "(" ")" org-match-sexp-depth) "\\)"
         "\\|"
         "\\(?:\\*\\|[+-]?[[:alnum:].,\\]*[[:alnum:]]\\)\\)"))
(org-set-emph-re 'org-emphasis-regexp-components org-emphasis-regexp-components)
(org-element-update-syntax)
#+end_src

** Ends
#+begin_src emacs-lisp

(provide 'init-org)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-org.el ends here
  #+end_src
